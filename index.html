<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bat Yam 100</title>
    <link rel="icon" type="image/png" href="favicon.png">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700;900&display=swap" rel="stylesheet">
    
    <style>
        body { background: #f8fafc; font-family: 'Heebo', sans-serif; padding-bottom: 30px; }
        .hero { background: linear-gradient(135deg, #0077b6 0%, #0096c7 100%); height: 160px; border-radius: 0 0 30px 30px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }
        .card { background: white; border-radius: 18px; border: 1px solid #f1f5f9; box-shadow: 0 2px 10px rgba(0,0,0,0.02); transition: transform 0.2s; }
        .card:active { transform: scale(0.98); }
        .loader-spin { border: 3px solid #f3f3f3; border-top: 3px solid #0077b6; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .animate-slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

<div id="loader" class="fixed inset-0 bg-white z-[9999] flex flex-col items-center justify-center transition-opacity duration-300">
    <div class="w-12 h-12 border-4 border-blue-100 border-t-blue-600 rounded-full animate-spin mb-4"></div>
    <p class="text-slate-400 font-bold text-sm tracking-widest">注 转 拽住...</p>
</div>

<div class="max-w-md mx-auto min-h-screen">
    <div class="hero p-6 text-white flex flex-col justify-between shadow-xl">
        <div class="flex justify-between items-center">
            <div class="bg-white/20 backdrop-blur-md px-4 py-1.5 rounded-full text-[10px] font-bold border border-white/10 uppercase tracking-wider">Bat Yam Municipality</div>
            <div class="flex gap-2">
                <button onclick="loadData()" class="bg-white/20 p-2 rounded-full hover:bg-white/30 transition"><i data-lucide="refresh-cw" class="w-5 h-5"></i></button>
                <button onclick="document.getElementById('addModal').classList.remove('hidden')" class="bg-white/40 p-2 rounded-full hover:bg-white/50 transition"><i data-lucide="plus" class="w-5 h-5"></i></button>
            </div>
        </div>
        <div>
            <h1 class="text-3xl font-black tracking-tighter leading-none">BAT YAM <span class="text-yellow-400">100</span></h1>
            <p class="text-blue-50 text-xs font-medium mt-1 opacity-90"> 驻专拽 专注 2026</p>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 px-6 -mt-6 relative z-10">
        <div class="card p-4 text-center">
            <span class="text-[10px] text-slate-400 font-black uppercase block mb-1">驻专拽</span>
            <span id="stat-total" class="text-2xl font-black text-blue-600">0</span>
        </div>
        <div class="card p-4 text-center">
            <span class="text-[10px] text-slate-400 font-black uppercase block mb-1">住专</span>
            <span class="text-xs font-bold text-green-500 flex items-center justify-center gap-1 mt-2">
                <i data-lucide="check-circle" class="w-3 h-3"></i> 驻注
            </span>
        </div>
    </div>

    <div class="p-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="font-black text-slate-800 text-lg">专注 拽专</h2>
        </div>
        <div id="listView" class="space-y-3">
            </div>
    </div>
</div>

<div id="addModal" class="fixed inset-0 bg-slate-900/60 hidden z-[100] flex items-end sm:items-center justify-center backdrop-blur-sm p-0 sm:p-4 transition-all">
    <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl p-8 shadow-2xl animate-slide-up">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-black text-slate-800">专注 砖</h2>
            <button onclick="document.getElementById('addModal').classList.add('hidden')" class="p-2 bg-slate-100 rounded-full"><i data-lucide="x" class="w-4 h-4 text-slate-400"></i></button>
        </div>
        
        <div class="space-y-4">
            <div>
                <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">砖 专注 / 驻专拽</label>
                <input id="inTitle" type="text" placeholder="砖: 砖驻抓 转" class="w-full p-4 bg-slate-50 rounded-2xl border border-slate-100 outline-none focus:border-blue-500 font-bold transition">
            </div>
            
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">转专</label>
                    <input id="inDate" type="text" placeholder="DD/MM/YYYY" class="w-full p-4 bg-slate-50 rounded-2xl border border-slate-100 outline-none focus:border-blue-500 transition">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase mb-1 block">专</label>
                    <input id="inOwner" type="text" placeholder="砖" class="w-full p-4 bg-slate-50 rounded-2xl border border-slate-100 outline-none focus:border-blue-500 transition">
                </div>
            </div>

            <button onclick="saveToExcel()" id="saveBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white py-4 rounded-2xl font-black shadow-lg shadow-blue-200 active:scale-95 transition flex justify-center items-center gap-3 mt-4">
                <i data-lucide="send" class="w-5 h-5"></i>
                <span>砖专 住专 拽住</span>
            </button>
        </div>
    </div>
</div>

<script>
    // --- 专转 ---
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ02cU8av1KtchNykwq-QxjU6LiLZx-CSp5B28BxAgnsvJjlTwMMW1QO8qNylEYC78qDQFT_S3-fzUA/pub?output=csv";
    
    // 拽砖专 砖:
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxpdgCT9MgQGJbGRJupmNpEZOxSlWBi99GrAznCFVUM7NsMKytt4gjquKR333sTb62vbg/exec";

    let events = [];

    // 注转 转
    async function loadData() {
        document.getElementById('loader').classList.remove('hidden');
        try {
            const response = await fetch(CSV_URL + '&t=' + Date.now());
            const csvText = await response.text();
            
            Papa.parse(csvText, {
                header: true, skipEmptyLines: true,
                complete: (results) => {
                    events = results.data;
                    renderList();
                    document.getElementById('stat-total').innerText = events.length;
                    document.getElementById('loader').classList.add('hidden');
                }
            });
        } catch (e) {
            console.error("Error loading data:", e);
            document.getElementById('loader').classList.add('hidden');
        }
    }

    // 转爪
    function renderList() {
        const container = document.getElementById('listView');
        container.innerHTML = '';
        
        if (events.length === 0) {
            container.innerHTML = '<div class="text-center py-10 text-slate-400 font-medium"> 专注 爪</div>';
            return;
        }

        //  驻 - 砖 注
        [...events].reverse().forEach(e => {
            const title = e.Title || e['砖 专注'] || ' 砖';
            const date = e.Date || e['转专'] || '--/--';
            const owner = e.Owner || e['专'] || '-';
            
            container.innerHTML += `
                <div class="card p-5 flex items-center gap-5 border-r-4 border-r-blue-500">
                    <div class="w-12 h-12 bg-blue-50 rounded-2xl flex flex-col items-center justify-center border border-blue-100 text-blue-600 font-black shrink-0">
                        <span class="text-lg leading-none">${date.split('/')[0] || '?'}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <h3 class="font-bold text-slate-800 truncate text-base">${title}</h3>
                        <p class="text-xs text-slate-400 font-bold mt-0.5"> ${owner}</p>
                    </div>
                    <i data-lucide="chevron-left" class="w-4 h-4 text-slate-300"></i>
                </div>
            `;
        });
        lucide.createIcons();
    }

    // 砖 (转 住拽专驻 砖)
    async function saveToExcel() {
        const title = document.getElementById('inTitle').value;
        const date = document.getElementById('inDate').value;
        const owner = document.getElementById('inOwner').value;

        if(!title) return alert("  砖 专注");

        const btn = document.getElementById('saveBtn');
        btn.innerHTML = '<div class="loader-spin"></div> <span>砖专...</span>';
        btn.disabled = true;

        // 转 转 爪专 驻砖: title, date, owner
        const formData = new URLSearchParams();
        formData.append('title', title);
        formData.append('date', date);  // 砖 -dateStr -date
        formData.append('owner', owner);

        try {
            await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: formData.toString()
            });

            // 注 驻
            events.unshift({ "Title": title, "Date": date, "Owner": owner });
            renderList();
            
            alert("转 砖 爪!");
            document.getElementById('addModal').classList.add('hidden');
            
            document.getElementById('inTitle').value = '';
            document.getElementById('inDate').value = '';
            document.getElementById('inOwner').value = '';

            setTimeout(loadData, 3000);

        } catch (e) {
            alert("砖 转拽砖专转 注 砖专转");
            console.error(e);
        } finally {
            btn.innerHTML = '<i data-lucide="send" class="w-5 h-5"></i> <span>砖专 住专 拽住</span>';
            btn.disabled = false;
            lucide.createIcons();
        }
    }

    document.addEventListener('DOMContentLoaded', loadData);
</script>

</body>
</html>
