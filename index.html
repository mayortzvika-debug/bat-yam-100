<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Bat Yam 100</title>
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&family=Frank+Ruhl+Libre:wght@400;700;900&display=swap" rel="stylesheet">

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DESIGN DIRECTION: Municipal Bold â€” ×¢×™×¦×•×‘
   ×¢×¨×™×›×ª×™ ×›×‘×“, ×¤×¡×™ ×¦×‘×¢, ×§×•× ×˜×¨×¡×˜ ×—×“, 
   Serif + Heebo, ×ª×—×•×©×ª ×¢×™×ª×•×Ÿ ×××©×œ×ª×™ ×™×•×§×¨×ª×™
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

:root {
  --ink: #0d1b2a;
  --blue: #0057a8;
  --sky: #2196f3;
  --gold: #f5a623;
  --mint: #00b89c;
  --bg: #f4f6f9;
  --card: #ffffff;
  --border: #e4e9f0;
  --muted: #7a8899;
}
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--bg);
  font-family: 'Heebo', sans-serif;
  padding-bottom: 110px;
  -webkit-tap-highlight-color: transparent;
  overscroll-behavior-y: none;
  color: var(--ink);
}
@keyframes spin { to { transform: rotate(360deg); } }
@keyframes up   { from { transform: translateY(110%); } to { transform: translateY(0); } }
@keyframes pop  { from { transform: scale(.82); opacity: 0; } to { transform: scale(1); opacity: 1; } }
@keyframes fade { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
@keyframes pulse { 0%,100% { opacity: 1; } 50% { opacity: .5; } }

/* â”€â”€ LOADER â”€â”€ */
#ldr {
  position: fixed; inset: 0; background: var(--ink); z-index: 9999;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  transition: opacity .5s;
}
#ldr .ring {
  width: 60px; height: 60px;
  border: 3px solid rgba(255,255,255,.12);
  border-top-color: var(--gold);
  border-radius: 50%;
  animation: spin 1s linear infinite;
  margin-bottom: 18px;
}
#ldr p { color: rgba(255,255,255,.4); font-size: 10px; font-weight: 700; letter-spacing: .2em; text-transform: uppercase; }

/* â”€â”€ HERO â”€â”€ */
.hero {
  position: relative; height: 240px;
  border-radius: 0 0 32px 32px; overflow: hidden;
  background: var(--ink);
  box-shadow: 0 20px 48px -12px rgba(13,27,42,.6);
}
.hero-bg {
  background-image: url('baner.jpg');
  background-size: cover; background-position: center;
  position: absolute; inset: 0; opacity: .55;
}
.hero-stripe {
  position: absolute; bottom: 0; left: 0; right: 0; height: 4px;
  background: linear-gradient(90deg, var(--gold) 0%, var(--mint) 50%, var(--sky) 100%);
}
.hero-c {
  position: relative; z-index: 2; padding: 22px 20px;
  height: 100%; display: flex; flex-direction: column; justify-content: space-between;
}
.glass-pill {
  background: rgba(255,255,255,.14);
  backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px);
  border: 1px solid rgba(255,255,255,.22);
  color: white; border-radius: 40px;
  display: inline-flex; align-items: center; gap: 7px;
  padding: 7px 14px; font-size: 12px; font-weight: 700;
  cursor: pointer; transition: all .18s;
}
.glass-pill:active { transform: scale(.92); background: rgba(255,255,255,.28); }
.glass-ic {
  background: rgba(255,255,255,.14);
  backdrop-filter: blur(14px); -webkit-backdrop-filter: blur(14px);
  border: 1px solid rgba(255,255,255,.22);
  color: white; border-radius: 50%;
  width: 38px; height: 38px;
  display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: all .18s;
}
.glass-ic:active { transform: scale(.9); }
.hero-title {
  font-family: 'Frank Ruhl Libre', serif;
  font-size: 42px; font-weight: 900; color: white;
  line-height: .95; letter-spacing: -1px;
  text-shadow: 0 2px 16px rgba(0,0,0,.4);
}
.hero-title span { color: var(--gold); }
.hero-sub { color: rgba(255,255,255,.7); font-size: 13px; font-weight: 400; margin-top: 6px; }
.hero-dot { width: 8px; height: 8px; border-radius: 50%; background: #4ade80; animation: pulse 2s infinite; }

/* â”€â”€ STAT CARDS â”€â”€ */
.stats-row { display: flex; gap: 10px; padding: 0 16px; margin: -22px 0 20px; position: relative; z-index: 5; }
.stat {
  flex: 1; background: var(--card);
  border-radius: 16px; padding: 14px 12px;
  box-shadow: 0 4px 20px rgba(0,0,0,.08);
  border-top: 3px solid transparent;
  animation: fade .4s ease both;
}
.stat:nth-child(1) { border-top-color: var(--blue); }
.stat:nth-child(2) { border-top-color: var(--mint); animation-delay: .08s; }
.stat:nth-child(3) { border-top-color: var(--gold); animation-delay: .16s; }
.stat-num { font-size: 32px; font-weight: 900; color: var(--ink); line-height: 1; }
.stat-lbl { font-size: 10px; font-weight: 700; color: var(--muted); margin-top: 3px; text-transform: uppercase; letter-spacing: .04em; }

/* â”€â”€ SECTION HEADER â”€â”€ */
.sec-head {
  display: flex; justify-content: space-between; align-items: center;
  padding: 0 16px; margin-bottom: 14px;
}
.sec-title {
  font-size: 13px; font-weight: 900; color: var(--ink);
  display: flex; align-items: center; gap: 8px;
  text-transform: uppercase; letter-spacing: .06em;
}
.sec-title::before {
  content: ''; width: 3px; height: 16px;
  background: var(--blue); border-radius: 2px; display: block;
}

/* â”€â”€ EVENT CARD â”€â”€ */
.ecard {
  background: var(--card); border-radius: 18px;
  box-shadow: 0 2px 12px rgba(0,0,0,.06);
  border: 1px solid var(--border);
  display: flex; align-items: stretch;
  overflow: hidden; cursor: pointer;
  transition: transform .15s, box-shadow .15s;
  animation: fade .35s ease both;
}
.ecard:active { transform: scale(.975); box-shadow: 0 1px 6px rgba(0,0,0,.07); }
.ecard-accent {
  width: 5px; flex-shrink: 0;
  background: var(--blue);
}
.ecard-accent.mine { background: var(--mint); }
.ecard-accent.done { background: #d1d5db; }
.ecard-date {
  width: 58px; flex-shrink: 0;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 14px 0;
  border-left: 1px solid var(--border);
  background: #fafbfc;
}
.ecard-date .day { font-size: 26px; font-weight: 900; color: var(--ink); line-height: 1; }
.ecard-date .day.range { font-size: 16px; font-weight: 900; color: var(--blue); line-height: 1.1; }
.ecard-date .mon { font-size: 9px; font-weight: 700; color: var(--muted); text-transform: uppercase; margin-top: 2px; }
.ecard-body { flex: 1; padding: 14px 14px 14px 12px; min-width: 0; }
.ecard-title { font-size: 15px; font-weight: 700; color: var(--ink); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 5px; }
.ecard-meta { display: flex; align-items: center; gap: 6px; flex-wrap: wrap; }
.ecard-owner { font-size: 11px; color: var(--muted); font-weight: 600; }

/* â”€â”€ STATUS PILL â”€â”€ */
.pill {
  display: inline-block; padding: 3px 9px; border-radius: 20px;
  font-size: 10px; font-weight: 700; letter-spacing: .02em;
  white-space: nowrap;
}
.pill-new  { background: #dbeafe; color: #1e40af; }
.pill-wip  { background: #fef3c7; color: #92400e; }
.pill-done { background: #d1fae5; color: #065f46; }
.pill-wait { background: #f3f4f6; color: #4b5563; }

/* â”€â”€ NAV BAR â”€â”€ */
.nav {
  position: fixed; bottom: 18px; left: 14px; right: 14px;
  background: var(--ink);
  padding: 6px 10px; border-radius: 28px;
  display: flex; justify-content: space-between; align-items: center;
  box-shadow: 0 16px 48px -8px rgba(13,27,42,.55);
  z-index: 40;
}
.nb {
  padding: 10px 13px; border-radius: 20px;
  color: rgba(255,255,255,.4);
  display: flex; flex-direction: column; align-items: center; gap: 3px;
  font-size: 9px; font-weight: 700; letter-spacing: .04em;
  background: none; border: none; cursor: pointer;
  transition: all .2s; text-transform: uppercase;
}
.nb.on { color: white; background: rgba(255,255,255,.12); }
.nadd {
  background: var(--gold);
  color: var(--ink); padding: 14px; border-radius: 22px;
  box-shadow: 0 6px 24px rgba(245,166,35,.5);
  transform: translateY(-18px); border: 4px solid var(--ink);
  cursor: pointer; transition: all .18s;
}
.nadd:active { transform: translateY(-18px) scale(.9); }

/* â”€â”€ CALENDAR â”€â”€ */
.cal-grid { display: grid; grid-template-columns: repeat(7,1fr); gap: 3px; }
.cal-head { display: grid; grid-template-columns: repeat(7,1fr); gap: 3px; text-align: center; font-size: 9px; font-weight: 900; color: var(--muted); text-transform: uppercase; letter-spacing: .05em; margin-bottom: 5px; }
.cday {
  min-height: 64px; background: var(--card);
  border-radius: 10px; border: 1px solid var(--border);
  padding: 4px; overflow: hidden;
  transition: border-color .15s;
}
.cday.tod { border: 2px solid var(--blue); background: #eff6ff; }
.cday.range-day { background: #f0fdf9; border-color: #6ee7d0; }
.cemp { min-height: 64px; border-radius: 10px; background: rgba(228,233,240,.3); }
.cnum { font-size: 11px; font-weight: 800; display: block; color: var(--muted); }
.cnum.tod-num { color: var(--blue); }
.cev {
  background: var(--blue); color: white;
  padding: 2px 4px; border-radius: 4px; margin-top: 2px;
  white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
  font-size: 8px; font-weight: 700; display: block; cursor: pointer;
}
.cev.mine  { background: var(--mint); }
.cev.range { background: linear-gradient(90deg, var(--blue), var(--sky)); }

/* â”€â”€ OVERLAY / SHEET â”€â”€ */
.ov {
  position: fixed; inset: 0;
  background: rgba(13,27,42,.7);
  display: flex; align-items: flex-end; justify-content: center;
  z-index: 150; backdrop-filter: blur(6px);
}
@media (min-width: 768px) {
  .ov { align-items: center; padding: 20px; }
}
.sh {
  background: var(--card); width: 100%; max-width: 480px;
  border-radius: 28px 28px 0 0;
  display: flex; flex-direction: column; max-height: 92vh;
  animation: up .32s cubic-bezier(.16,1,.3,1);
  box-shadow: 0 -8px 48px rgba(13,27,42,.25);
}
@media (min-width: 768px) {
  .sh { 
    border-radius: 28px; 
    max-height: 85vh;
    animation: pop .32s cubic-bezier(.16,1,.3,1);
  }
}
.sh-handle { width: 40px; height: 4px; background: var(--border); border-radius: 2px; margin: 12px auto 0; }
@media (min-width: 768px) {
  .sh-handle { display: none; }
}
.sh-head {
  padding: 16px 20px;
  display: flex; justify-content: space-between; align-items: center;
  border-bottom: 1px solid var(--border);
  flex-shrink: 0;
}
.sh-title { font-size: 18px; font-weight: 900; color: var(--ink); }

/* â”€â”€ LOGIN â”€â”€ */
.lw {
  position: fixed; inset: 0; background: var(--ink);
  z-index: 200; display: flex; align-items: center; justify-content: center; padding: 24px;
}
.lb {
  background: white; border-radius: 28px; padding: 36px 28px;
  width: 100%; max-width: 360px; text-align: center;
  animation: pop .38s cubic-bezier(.16,1,.3,1);
}
.lb-top { height: 5px; border-radius: 5px 5px 0 0; margin: -36px -28px 32px; background: linear-gradient(90deg,var(--gold),var(--mint),var(--sky)); border-radius: 28px 28px 0 0; }
.chip {
  padding: 10px 18px; border-radius: 40px;
  border: 2px solid var(--border);
  cursor: pointer; font-weight: 700; font-size: 14px;
  background: white; transition: all .15s;
  font-family: 'Heebo', sans-serif; color: var(--ink);
}
.chip:hover, .chip.sel { border-color: var(--blue); background: #eff6ff; color: var(--blue); }

/* â”€â”€ FORM ELEMENTS â”€â”€ */
.fld {
  width: 100%; padding: 12px 14px;
  background: #f8fafc; border-radius: 12px;
  border: 1.5px solid var(--border); outline: none;
  font-family: 'Heebo', sans-serif; font-size: 14px;
  color: var(--ink); transition: all .2s;
}
.fld:focus { border-color: var(--blue); background: white; box-shadow: 0 0 0 3px rgba(0,87,168,.1); }
.fld-lg { font-size: 17px; font-weight: 700; padding: 14px; }
label.lbl { font-size: 10px; font-weight: 900; color: var(--muted); text-transform: uppercase; letter-spacing: .05em; display: block; margin-bottom: 6px; }

/* â”€â”€ STATUS BTNS â”€â”€ */
.sb {
  flex: 1; padding: 9px 6px; border-radius: 12px;
  font-weight: 700; font-size: 12px;
  border: 2px solid var(--border); background: #f8fafc; color: var(--muted);
  cursor: pointer; font-family: 'Heebo', sans-serif; transition: all .15s;
}
.sb.active-n { border-color: #93c5fd; background: #dbeafe; color: #1e40af; }
.sb.active-w { border-color: #fcd34d; background: #fef3c7; color: #92400e; }
.sb.active-d { border-color: #6ee7b7; background: #d1fae5; color: #065f46; }

/* â”€â”€ TASK ROW â”€â”€ */
.tr {
  display: flex; align-items: center; gap: 10px;
  padding: 10px 12px; background: #f8fafc;
  border-radius: 10px; border: 1px solid var(--border);
  transition: all .15s;
}
.tr input[type=checkbox] { width: 18px; height: 18px; accent-color: var(--blue); cursor: pointer; flex-shrink: 0; }
.tr.done span { text-decoration: line-through; color: var(--muted); }

/* â”€â”€ CLOSE BTN â”€â”€ */
.close-btn {
  width: 34px; height: 34px; border-radius: 50%;
  background: #f1f5f9; border: none; cursor: pointer;
  display: flex; align-items: center; justify-content: center;
  transition: background .15s;
}
.close-btn:hover { background: #e2e8f0; }

/* â”€â”€ RANGE BADGE â”€â”€ */
.range-badge {
  display: inline-flex; align-items: center; gap: 4px;
  background: linear-gradient(90deg,#eff6ff,#f0fdf9);
  border: 1px solid #bfdbfe; border-radius: 20px;
  padding: 2px 8px; font-size: 10px; font-weight: 700; color: var(--blue);
}

.add-task-btn {
  color: var(--blue); font-size: 12px; font-weight: 700;
  background: #eff6ff; border: none; border-radius: 8px;
  padding: 5px 10px; cursor: pointer;
  font-family: 'Heebo', sans-serif; transition: background .15s;
}
.add-task-btn:hover { background: #dbeafe; }

.badge { position: absolute; top: 5px; right: 5px; width: 8px; height: 8px; background: #ef4444; border-radius: 50%; border: 2px solid var(--ink); }
.sh-hide::-webkit-scrollbar { display: none; }
.sh-hide { -ms-overflow-style: none; scrollbar-width: none; }
</style>
</head>
<body>

<!-- LOADER -->
<div id="ldr">
  <div class="ring"></div>
  <p>BAT YAM 100</p>
</div>

<!-- LOGIN -->
<div id="lw" class="lw" style="display:none">
  <div class="lb">
    <div class="lb-top"></div>
    <div style="font-size:36px;margin-bottom:12px">ğŸ™ï¸</div>
    <h2 style="font-size:24px;font-weight:900;color:var(--ink);margin-bottom:4px;font-family:'Frank Ruhl Libre',serif">BAT YAM 100</h2>
    <p style="color:var(--muted);font-size:13px;margin-bottom:22px">××™ ××ª/×”?</p>
    <div id="lchips" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:16px"></div>
    <input id="lname" type="text" placeholder="×©× ××—×¨..." class="fld" style="text-align:center;margin-bottom:14px">
    <button id="lbtn" style="width:100%;background:var(--ink);color:white;padding:14px;border-radius:14px;font-weight:900;font-size:15px;border:none;cursor:pointer;font-family:'Heebo',sans-serif;letter-spacing:.03em">
      ×›× ×™×¡×” â†
    </button>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none" class="max-w-md mx-auto">

  <!-- HERO -->
  <div class="hero">
    <div class="hero-bg"></div>
    <div class="hero-c">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <button id="btnUser" class="glass-pill">
          <span class="hero-dot"></span>
          <span id="uLabel">××•×¨×—</span>
          <i data-lucide="chevron-down" style="width:13px;height:13px;opacity:.7"></i>
        </button>
        <div style="display:flex;gap:8px">
          <button id="btnNotif"  class="glass-ic"><i data-lucide="bell"        style="width:17px;height:17px"></i></button>
          <button id="btnRefresh" class="glass-ic"><i data-lucide="refresh-cw" style="width:17px;height:17px"></i></button>
        </div>
      </div>
      <div>
        <div class="hero-title">BAT YAM<br><span>100</span></div>
        <p class="hero-sub">× ×™×”×•×œ ×¤×¨×•×™×§×˜×™× ×¢×™×¨×•× ×™ Â· 2026</p>
      </div>
    </div>
    <div class="hero-stripe"></div>
  </div>

  <!-- STATS -->
  <div class="stats-row">
    <div class="stat">
      <div id="stT" class="stat-num">0</div>
      <div class="stat-lbl">×¤×¨×•×™×§×˜×™×</div>
    </div>
    <div class="stat">
      <div id="stM" class="stat-num">0</div>
      <div class="stat-lbl">×©×œ×™</div>
    </div>
    <div class="stat">
      <div id="stA" class="stat-num">0</div>
      <div class="stat-lbl">×‘×˜×™×¤×•×œ</div>
    </div>
  </div>

  <!-- CONTENT -->
  <div style="padding:0 0 0">

    <!-- LIST VIEW -->
    <div id="vList">
      <div class="sec-head">
        <span class="sec-title">×›×œ ×”×¤×¨×•×™×§×˜×™×</span>
        <span id="countBadge" style="font-size:11px;font-weight:700;color:var(--muted)"></span>
      </div>
      <div id="eCards" style="display:grid;grid-template-columns:1fr;gap:10px;padding:0 16px 112px"></div>
      <style>
        @media (min-width: 768px) {
          #eCards { grid-template-columns: repeat(2, 1fr); }
        }
        @media (min-width: 1024px) {
          #eCards { grid-template-columns: repeat(3, 1fr); }
        }
      </style>
    </div>

    <!-- CALENDAR VIEW -->
    <div id="vCal" style="display:none;padding:0 16px">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:14px">
        <div>
          <div class="sec-title" style="margin-bottom:2px">×œ×•×— ×©× ×”</div>
          <h2 id="calTit" style="font-size:18px;font-weight:900;color:var(--ink)"></h2>
        </div>
        <div style="display:flex;gap:8px">
          <button id="calP" style="padding:9px;background:var(--card);border-radius:50%;border:1.5px solid var(--border);cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.07)"><i data-lucide="chevron-right" style="width:16px;height:16px;color:var(--ink)"></i></button>
          <button id="calN" style="padding:9px;background:var(--card);border-radius:50%;border:1.5px solid var(--border);cursor:pointer;box-shadow:0 2px 6px rgba(0,0,0,.07)"><i data-lucide="chevron-left"  style="width:16px;height:16px;color:var(--ink)"></i></button>
        </div>
      </div>
      <div class="cal-head"><div>××³</div><div>×‘×³</div><div>×’×³</div><div>×“×³</div><div>×”×³</div><div>×•×³</div><div>×©×³</div></div>
      <div id="calG" class="cal-grid" style="padding-bottom:112px"></div>
    </div>

    <!-- TASKS VIEW -->
    <div id="vTasks" style="display:none">
      <div class="sec-head" style="padding-top:4px">
        <span class="sec-title">××©×™××•×ª ×¤×ª×•×—×•×ª</span>
        <select id="tFilter" style="font-size:11px;font-weight:700;background:var(--card);border:1.5px solid var(--border);border-radius:10px;padding:6px 12px;outline:none;font-family:'Heebo',sans-serif;color:var(--ink);cursor:pointer">
          <option value="">×›×•×œ×</option>
        </select>
      </div>
      <div id="tCards" style="display:flex;flex-direction:column;gap:10px;padding:0 16px 112px"></div>
    </div>

  </div>

  <!-- NAV -->
  <div class="nav">
    <button id="nb-list"  class="nb on"><i data-lucide="home"         style="width:20px;height:20px"></i><span>×‘×™×ª</span></button>
    <button id="nb-tasks" class="nb" style="position:relative"><i data-lucide="check-square" style="width:20px;height:20px"></i><span>××©×™××•×ª</span><span id="tbadge" class="badge" style="display:none"></span></button>
    <button id="nb-add"   class="nadd"><i data-lucide="plus" style="width:26px;height:26px"></i></button>
    <button id="nb-cal"   class="nb"><i data-lucide="calendar"        style="width:20px;height:20px"></i><span>×œ×•×— ×©× ×”</span></button>
    <button id="nb-set"   class="nb"><i data-lucide="user"            style="width:20px;height:20px"></i><span>×¤×¨×•×¤×™×œ</span></button>
  </div>
</div>

<!-- â•â•â• ADD MODAL â•â•â• -->
<div id="mAdd" class="ov" style="display:none">
  <div class="sh" style="height:91vh">
    <div class="sh-handle"></div>
    <div class="sh-head">
      <span class="sh-title">×¤×¨×•×™×§×˜ ×—×“×©</span>
      <button id="mAddClose" class="close-btn"><i data-lucide="x" style="width:17px;height:17px;color:var(--muted)"></i></button>
    </div>
    <div style="flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:18px" class="sh-hide">

      <div>
        <label class="lbl">×©× ×”××™×¨×•×¢ *</label>
        <input id="inT" type="text" class="fld fld-lg" placeholder="×©× ×”××™×¨×•×¢...">
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div>
          <label class="lbl">×ª××¨×™×š ×”×ª×—×œ×”</label>
          <input id="inD" type="date" class="fld">
        </div>
        <div>
          <label class="lbl">×ª××¨×™×š ×¡×™×•× (××•×¤×¦×™×•× ×œ×™)</label>
          <input id="inDEnd" type="date" class="fld">
        </div>
      </div>

      <div>
        <label class="lbl">××—×¨××™</label>
        <select id="inO" class="fld">
          <option value="">×‘×—×¨ ××—×¨××™...</option>
        </select>
      </div>

      <div>
        <label class="lbl">×¡×˜×˜×•×¡</label>
        <div id="sBtns" style="display:flex;gap:8px">
          <button class="sb active-n" data-v="×—×“×©">×—×“×©</button>
          <button class="sb" data-v="×‘×˜×™×¤×•×œ">×‘×˜×™×¤×•×œ</button>
          <button class="sb" data-v="×‘×•×¦×¢">×‘×•×¦×¢</button>
        </div>
        <input type="hidden" id="inS" value="×—×“×©">
      </div>

      <div>
        <label class="lbl">×ª×™××•×¨</label>
        <textarea id="inDesc" rows="3" class="fld" style="resize:none" placeholder="×ª×™××•×¨, ×”×¢×¨×•×ª..."></textarea>
      </div>

      <div style="background:#f8fafc;padding:16px;border-radius:14px;border:1.5px solid var(--border)">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <label class="lbl" style="margin:0">××©×™××•×ª</label>
          <button id="btnAddTask" class="add-task-btn">+ ×”×•×¡×£ ××©×™××”</button>
        </div>
        <div id="tList" style="display:flex;flex-direction:column;gap:8px"></div>
      </div>

      <label style="display:flex;align-items:center;gap:12px;padding:14px;border:2px dashed var(--border);border-radius:14px;cursor:pointer;transition:border-color .2s">
        <input type="file" id="inImg" style="display:none" accept="image/*">
        <i data-lucide="image-plus" style="width:20px;height:20px;color:var(--muted);flex-shrink:0"></i>
        <div>
          <span id="imgSt" style="font-size:13px;font-weight:700;color:var(--muted);display:block">×”×•×¡×£ ×ª××•× ×”</span>
          <span style="font-size:10px;color:#cbd5e1">×¢×“ ~37KB</span>
        </div>
      </label>
      <div id="imgPW" style="display:none;height:140px;border-radius:12px;overflow:hidden;border:1px solid var(--border)">
        <img id="imgPE" style="width:100%;height:100%;object-fit:cover">
      </div>

    </div>
    <div style="padding:16px;border-top:1.5px solid var(--border);flex-shrink:0">
      <button id="saveBtn" style="width:100%;background:var(--ink);color:white;padding:16px;border-radius:14px;font-weight:900;font-size:15px;border:none;cursor:pointer;font-family:'Heebo',sans-serif;box-shadow:0 4px 18px rgba(13,27,42,.35);letter-spacing:.03em">
        ×©××•×¨ ×•×¡× ×›×¨×Ÿ â†
      </button>
    </div>
  </div>
</div>

<!-- â•â•â• VIEW MODAL â•â•â• -->
<div id="mView" class="ov" style="display:none">
  <div class="sh" style="height:88vh">
    <div style="height:180px;position:relative;flex-shrink:0;overflow:hidden;border-radius:28px 28px 0 0">
      <img id="vImg" style="width:100%;height:100%;object-fit:cover;display:none">
      <div id="vImgPH" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#f0f9ff,#f8fafc)">
        <i data-lucide="image" style="width:52px;height:52px;color:#e2e8f0"></i>
      </div>
      <div style="position:absolute;inset:0;background:linear-gradient(to bottom,transparent 40%,rgba(13,27,42,.5))"></div>
      <button id="mViewClose" style="position:absolute;top:14px;left:14px;background:rgba(0,0,0,.35);color:white;padding:8px;border-radius:50%;border:none;cursor:pointer;backdrop-filter:blur(6px)">
        <i data-lucide="x" style="width:18px;height:18px"></i>
      </button>
      <div id="vPill" style="position:absolute;bottom:14px;right:16px"></div>
    </div>

    <div style="flex:1;overflow-y:auto;padding:20px 20px 10px" class="sh-hide">
      <h2 id="vT" style="font-size:22px;font-weight:900;color:var(--ink);line-height:1.25;margin-bottom:8px;font-family:'Frank Ruhl Libre',serif"></h2>
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:18px;flex-wrap:wrap">
        <span id="vDate" style="display:inline-flex;align-items:center;gap:5px;font-size:12px;font-weight:700;color:var(--blue);background:#eff6ff;padding:4px 10px;border-radius:20px">
          <i data-lucide="calendar" style="width:12px;height:12px"></i>
          <span id="vDateTxt"></span>
        </span>
        <span id="vOwn" style="font-size:12px;font-weight:600;color:var(--muted)"></span>
      </div>

      <!-- View status -->
      <div id="vsBtns" style="display:flex;gap:8px;margin-bottom:18px">
        <button class="vsb sb" data-v="×—×“×©">×—×“×©</button>
        <button class="vsb sb" data-v="×‘×˜×™×¤×•×œ">×‘×˜×™×¤×•×œ</button>
        <button class="vsb sb" data-v="×‘×•×¦×¢">×‘×•×¦×¢</button>
      </div>

      <p id="vDesc" style="font-size:13px;color:#475569;line-height:1.65;background:#f8fafc;padding:14px;border-radius:12px;margin-bottom:18px;border:1px solid var(--border)"></p>

      <div style="background:#f8fafc;padding:16px;border-radius:14px;border:1.5px solid var(--border)">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <span style="font-size:10px;font-weight:900;color:var(--muted);text-transform:uppercase;letter-spacing:.06em">××©×™××•×ª</span>
          <button id="btnVAddTask" class="add-task-btn">+ ×”×•×¡×£</button>
        </div>
        <div id="vtList" style="display:flex;flex-direction:column;gap:8px"></div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â• SETTINGS MODAL â•â•â• -->
<div id="mSet" class="ov" style="display:none">
  <div class="sh" style="border-radius:28px 28px 0 0;max-height:70vh">
    <div class="sh-handle"></div>
    <div class="sh-head">
      <span class="sh-title">×¤×¨×•×¤×™×œ</span>
      <button id="mSetClose" class="close-btn"><i data-lucide="x" style="width:17px;height:17px;color:var(--muted)"></i></button>
    </div>
    <div style="padding:20px;display:flex;flex-direction:column;gap:14px">
      <label class="lbl">×‘×—×¨ ××©×ª××©</label>
      <div id="schips" style="display:flex;flex-wrap:wrap;gap:8px"></div>
      <input id="sname" type="text" placeholder="×©× ××—×¨..." class="fld" style="text-align:center">
      <button id="btnSwitch" style="width:100%;background:var(--ink);color:white;padding:13px;border-radius:14px;font-weight:900;border:none;cursor:pointer;font-family:'Heebo',sans-serif">
        ×”×—×œ×£ ××©×ª××©
      </button>
    </div>
  </div>
</div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFIG
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CSV  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ02cU8av1KtchNykwq-QxjU6LiLZx-CSp5B28BxAgnsvJjlTwMMW1QO8qNylEYC78qDQFT_S3-fzUA/pub?output=csv";
const POST = "https://script.google.com/macros/s/AKfycbxpdgCT9MgQGJbGRJupmNpEZOxSlWBi99GrAznCFVUM7NsMKytt4gjquKR333sTb62vbg/exec";
let OWNERS = ['×‘×Ÿ','×¨×™× ×ª','×’×œ×™×ª','××‘×™×©×™','××•×¨','×™×•×¡×™','×¨×•×ª×'];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let events = [], me = localStorage.getItem('batyam_user') || '';
let calY = new Date().getFullYear(), calM = new Date().getMonth();
let img64 = '', viewIdx = -1;

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BOOT
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
window.addEventListener('DOMContentLoaded', () => {
  lucide.createIcons();
  wire();
  me ? boot() : showLogin();
});

function showLogin() { hide('ldr'); showFlex('lw'); buildChips('lchips'); }
function boot()      { id('uLabel').textContent = me; show('app'); loadData(); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EVENT WIRING â€” all addEventListener
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function wire() {
  id('lbtn').onclick   = doLogin;
  id('lname').onkeydown = e => { if(e.key==='Enter') doLogin(); };

  id('nb-list').onclick  = () => sv('List');
  id('nb-cal').onclick   = () => sv('Cal');
  id('nb-tasks').onclick = () => sv('Tasks');
  id('nb-add').onclick   = openAdd;
  id('nb-set').onclick   = openSet;
  id('btnUser').onclick  = openSet;
  id('btnRefresh').onclick = () => loadData(true);
  id('btnNotif').onclick = askNotif;

  id('mAddClose').onclick  = closeAdd;
  id('btnAddTask').onclick = () => addRow('tList');
  id('saveBtn').onclick    = save;
  id('inImg').onchange     = handleImg;

  id('sBtns').onclick = e => {
    const b = e.target.closest('.sb'); if(!b || !b.dataset.v) return;
    id('inS').value = b.dataset.v;
    id('sBtns').querySelectorAll('.sb').forEach(x => { x.className='sb'; });
    const cls = {×—×“×©:'sb active-n',×‘×˜×™×¤×•×œ:'sb active-w',×‘×•×¦×¢:'sb active-d'};
    b.className = cls[b.dataset.v] || 'sb';
  };

  id('mViewClose').onclick  = () => hide('mView');
  id('btnVAddTask').onclick = () => addRow('vtList');
  id('vsBtns').onclick = e => {
    const b = e.target.closest('.vsb'); if(b) changeSt(b.dataset.v);
  };

  id('mSetClose').onclick = () => hide('mSet');
  id('btnSwitch').onclick = doSwitch;
  id('tFilter').onchange  = renderTasks;
  id('calP').onclick = () => { calM--; if(calM<0){calM=11;calY--;} renderCal(); };
  id('calN').onclick = () => { calM++; if(calM>11){calM=0;calY++;} renderCal(); };

  ['mAdd','mView','mSet'].forEach(x => {
    id(x).onclick = e => { if(e.target.id===x) hide(x); };
  });
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HELPERS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const id = x => document.getElementById(x);
function show(x)    { id(x).style.display = 'block'; }
function hide(x)    { id(x).style.display = 'none';  }
function showFlex(x){ id(x).style.display = 'flex';  }
function showOv(x)  { id(x).style.display = 'flex'; lucide.createIcons(); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATE UTILS â€” ×ª×•××š ×‘×ª××¨×™×›×™× ××ª××©×›×™×
   D/M/YYYY, DD/MM/YYYY, YYYY-MM-DD
   ×˜×•×•×—: D/M/YYYY-D/M/YYYY  ××•  D/M-D/M/YYYY
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function parseSingle(s) {
  if(!s) return null; s = s.trim();
  let m = s.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
  if(m) return new Date(+m[3], +m[2]-1, +m[1]);
  m = s.match(/^(\d{4})-(\d{2})-(\d{2})$/);
  if(m) return new Date(+m[1], +m[2]-1, +m[3]);
  return null;
}

function parseEventDate(raw) {
  // ××—×–×™×¨: { start: Date, end: Date|null, isRange: bool }
  if(!raw) return { start:null, end:null, isRange:false };
  raw = raw.trim();

  // × ×™×¡×™×•×Ÿ ×œ×¤×¦×œ ×‘×˜×•×•×—: ××—×¤×© '-' ×©××¤×¨×™×“ ×‘×™×Ÿ ×©× ×™ ×ª××¨×™×›×™×
  // ×¤×•×¨××˜×™×: "30/7/2026-3/8/2026" ××• "26/7/2026-30/8/2026"
  const rangeMatch = raw.match(/^(\d{1,2}\/\d{1,2}\/\d{4})\s*-\s*(\d{1,2}\/\d{1,2}\/\d{4})$/);
  if(rangeMatch) {
    return { start: parseSingle(rangeMatch[1]), end: parseSingle(rangeMatch[2]), isRange: true };
  }

  // ×ª××¨×™×š ×‘×•×“×“
  const single = parseSingle(raw);
  return { start: single, end: null, isRange: false };
}

function dateInRange(evRaw, y, m, d) {
  const { start, end, isRange } = parseEventDate(evRaw);
  if(!start) return false;
  const check = new Date(y, m, d);
  if(isRange && end) {
    return check >= start && check <= end;
  }
  return start.getFullYear()===y && start.getMonth()===m && start.getDate()===d;
}

function fmtEventDate(raw) {
  const { start, end, isRange } = parseEventDate(raw);
  if(!start) return raw || '';
  const opts = { day:'numeric', month:'long' };
  if(isRange && end) {
    const s = start.toLocaleDateString('he-IL', opts);
    const e = end.toLocaleDateString('he-IL', { day:'numeric', month:'long', year:'numeric' });
    return `${s} â€“ ${e}`;
  }
  return start.toLocaleDateString('he-IL', { day:'numeric', month:'long', year:'numeric' });
}

function getDisplayDay(raw) {
  const { start, end, isRange } = parseEventDate(raw);
  if(!start) return { day:'?', isRange:false };
  if(isRange && end) {
    return { day: `${start.getDate()}â€“${end.getDate()}`, isRange:true };
  }
  return { day: String(start.getDate()), isRange:false };
}

function getMonthLabel(raw) {
  const { start } = parseEventDate(raw);
  if(!start) return '';
  return start.toLocaleDateString('he-IL',{month:'short'});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATUS â†’ PILL CLASS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function pillClass(st) {
  if(!st) return 'pill pill-new';
  if(st.includes('×‘×•×¦×¢') || st.includes('×ª×•××')) return 'pill pill-done';
  if(st.includes('×˜×™×¤×•×œ') || st.includes('×—×•×–×™×') || st.includes('×”×–×× ×”') || st.includes('×ª×”×œ×™×š')) return 'pill pill-wip';
  if(st.includes('×××ª×™×Ÿ') || st.includes('×ª×•××—×¨')) return 'pill pill-wait';
  return 'pill pill-new';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildChips(cid) {
  const c = id(cid); c.innerHTML = '';
  OWNERS.forEach(n => {
    const b = document.createElement('button');
    b.className = 'chip' + (n===me?' sel':'');
    b.textContent = n;
    b.onclick = () => { c.querySelectorAll('.chip').forEach(x=>x.classList.remove('sel')); b.classList.add('sel'); };
    c.appendChild(b);
  });
}
function getChip(cid, iid) {
  const s = document.querySelector(`#${cid} .chip.sel`);
  return s ? s.textContent : (id(iid)?.value.trim() || '');
}
function doLogin() {
  const n = getChip('lchips','lname');
  if(!n){ alert('×‘×—×¨/×™ ×©×'); return; }
  localStorage.setItem('batyam_user', n); me = n;
  hide('lw'); boot();
}
function openSet() { buildChips('schips'); showOv('mSet'); }
function doSwitch() {
  const n = getChip('schips','sname');
  if(!n){ alert('×‘×—×¨ ×©×'); return; }
  localStorage.setItem('batyam_user', n); me = n;
  id('uLabel').textContent = n;
  renderAll(); hide('mSet');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
async function loadData(manual=false) {
  if(manual) { id('ldr').style.cssText='position:fixed;inset:0;background:var(--ink);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:1'; }
  try {
    const r = await fetch(CSV+'&t='+Date.now());
    const t = await r.text();
    Papa.parse(t, { header:true, skipEmptyLines:true, complete: res => {
      events = res.data.filter(e => (e.Title||e.title||'').trim());

      // ×—×œ×¥ ×‘×¢×œ×™× ××”×’×™×œ×™×•×Ÿ
      events.forEach(e => {
        (e.owner||e.Owner||'').split(/[+,]/).map(x=>x.trim()).filter(Boolean).forEach(o => {
          if(!OWNERS.includes(o)) OWNERS.push(o);
        });
      });

      fillOwnerSelect();
      renderAll();
      hideLoader();
    }});
  } catch(e){ console.error(e); hideLoader(); }
}

function fillOwnerSelect() {
  const sel = id('inO'), cur = sel.value;
  sel.innerHTML = '<option value="">×‘×—×¨ ××—×¨××™...</option>';
  OWNERS.forEach(o => {
    const opt = document.createElement('option');
    opt.value = o; opt.textContent = o;
    if(o===cur) opt.selected = true;
    sel.appendChild(opt);
  });
}

function hideLoader() {
  const l = id('ldr');
  l.style.transition = 'opacity .5s';
  l.style.opacity = '0';
  setTimeout(()=>{ l.style.display='none'; }, 520);
}

function renderAll() {
  renderList(); renderCal(); renderTasks(); updateStats(); buildFilter();
  lucide.createIcons();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function updateStats() {
  id('stT').textContent = events.length;
  id('stM').textContent = events.filter(e=>(e.owner||e.Owner||'').includes(me)).length;
  id('stA').textContent = events.filter(e=>{const s=e.status||e.Status||''; return s.includes('×˜×™×¤×•×œ')||s.includes('×—×•×–×™×')||s.includes('×”×–×× ×”')||s.includes('×ª×”×œ×™×š');}).length;
  id('countBadge').textContent = events.length + ' ×¤×¨×•×™×§×˜×™×';
  const myOpen = events.filter(e=>(e.owner||e.Owner||'').includes(me)&&(e.status||e.Status||'')!=='×‘×•×¦×¢').length;
  id('tbadge').style.display = myOpen>0?'block':'none';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LIST
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderList() {
  const c = id('eCards'); c.innerHTML = '';
  if(!events.length){ c.innerHTML='<p style="text-align:center;color:var(--muted);padding:64px 0;font-weight:600">××™×Ÿ ×¤×¨×•×™×§×˜×™× ×¢×“×™×™×Ÿ</p>'; return; }
  
  // ××™×•×Ÿ ×›×¨×•× ×•×œ×•×’×™ ×œ×¤×™ ×ª××¨×™×š (×”×›×™ ××•×§×“× ×¨××©×•×Ÿ)
  const sorted = [...events].sort((a, b) => {
    const aRaw = a.date || a.Date || '';
    const bRaw = b.date || b.Date || '';
    const aDate = parseEventDate(aRaw).start;
    const bDate = parseEventDate(bRaw).start;
    if(!aDate && !bDate) return 0;
    if(!aDate) return 1;
    if(!bDate) return -1;
    return aDate - bDate;
  });

  const frag = document.createDocumentFragment();
  sorted.forEach((e, loopIdx) => {
    const origIdx = events.indexOf(e); // ×©××•×¨ ××ª ×”××™× ×“×§×¡ ×”××§×•×¨×™
    const title  = e.Title||e.title||'×œ×œ× ×©×';
    const raw    = e.date||e.Date||'';
    const owner  = e.owner||e.Owner||'-';
    const status = e.status||e.Status||'×—×“×©';
    const isMine = owner.includes(me);
    const isDone = status.includes('×‘×•×¦×¢') || status.includes('×ª×•××');
    const { day, isRange } = getDisplayDay(raw);
    const mon = getMonthLabel(raw);

    const div = document.createElement('div');
    div.className = 'ecard';
    div.style.animationDelay = (loopIdx * 0.04) + 's';

    const accent = document.createElement('div');
    accent.className = 'ecard-accent' + (isDone?' done':isMine?' mine':'');
    div.appendChild(accent);

    const dateBox = document.createElement('div');
    dateBox.className = 'ecard-date';
    dateBox.innerHTML = `<span class="day${isRange?' range':''}">${day}</span><span class="mon">${mon}</span>`;
    div.appendChild(dateBox);

    const body = document.createElement('div');
    body.className = 'ecard-body';
    body.innerHTML = `
      <div class="ecard-title">${title}</div>
      <div class="ecard-meta">
        <span class="${pillClass(status)}">${status}</span>
        <span class="ecard-owner">ğŸ‘¤ ${owner}${isMine?' Â· <b style="color:var(--mint)">×©×œ×™</b>':''}</span>
        ${isRange?`<span class="range-badge"><i data-lucide="calendar-range" style="width:10px;height:10px"></i> ×˜×•×•×—</span>`:''}
      </div>`;
    div.appendChild(body);
    div.addEventListener('click', ()=>openView(origIdx));
    frag.appendChild(div);
  });
  c.appendChild(frag);
  lucide.createIcons();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CALENDAR â€” ×ª×•××š ×‘×ª××¨×™×›×™× ××ª××©×›×™×
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderCal() {
  const g = id('calG'); g.innerHTML = '';
  id('calTit').textContent = new Date(calY,calM,1).toLocaleDateString('he-IL',{month:'long',year:'numeric'});

  const firstDay    = new Date(calY,calM,1).getDay();
  const daysInMonth = new Date(calY,calM+1,0).getDate();
  const today       = new Date();

  for(let i=0;i<firstDay;i++){
    const b=document.createElement('div'); b.className='cemp'; g.appendChild(b);
  }

  for(let d=1;d<=daysInMonth;d++){
    const isToday = d===today.getDate()&&calM===today.getMonth()&&calY===today.getFullYear();
    const cell = document.createElement('div');
    cell.className = 'cday' + (isToday?' tod':'');

    const num = document.createElement('span');
    num.className = 'cnum' + (isToday?' tod-num':'');
    num.textContent = d;
    cell.appendChild(num);

    // ×‘×“×•×§ ×›×œ ××™×¨×•×¢ â€” ×›×•×œ×œ ×˜×•×•×—×™×
    events.forEach((e, idx) => {
      const raw = e.date||e.Date||'';
      if(!dateInRange(raw, calY, calM, d)) return;

      const isMine = (e.owner||e.Owner||'').includes(me);
      const { isRange } = parseEventDate(raw);

      const ev = document.createElement('span');
      ev.className = 'cev' + (isMine?' mine':'') + (isRange?' range':'');
      ev.textContent = e.Title||e.title||'â€”';
      ev.onclick = evt => { evt.stopPropagation(); openView(idx); };
      cell.appendChild(ev);

      // ×¡××Ÿ ×™×•× ×›-range-day ×× ×”×•× ×—×œ×§ ××˜×•×•×— (×œ× ×¨×§ ×¨××©×•×Ÿ)
      const { start } = parseEventDate(raw);
      if(isRange && start && !(start.getDate()===d && start.getMonth()===calM && start.getFullYear()===calY)) {
        cell.classList.add('range-day');
      }
    });

    g.appendChild(cell);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TASKS
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function buildFilter() {
  const sel=id('tFilter'), cur=sel.value;
  const owners=[...new Set(events.map(e=>(e.owner||e.Owner||'').trim()).filter(Boolean))];
  sel.innerHTML='<option value="">×›×•×œ×</option>';
  owners.forEach(o=>{
    const opt=document.createElement('option');
    opt.value=o; opt.textContent=o;
    if(o===cur) opt.selected=true;
    sel.appendChild(opt);
  });
}

function renderTasks() {
  const c=id('tCards'); c.innerHTML='';
  const filter=id('tFilter').value;
  const open=events.filter(e=>{
    const st=e.status||e.Status||'';
    if(st==='×‘×•×¦×¢') return false;
    if(filter&&!(e.owner||e.Owner||'').includes(filter)) return false;
    return true;
  });
  if(!open.length){
    c.innerHTML='<div style="text-align:center;padding:64px 0"><div style="font-size:40px;margin-bottom:10px">ğŸ‰</div><p style="color:var(--muted);font-weight:600">××™×Ÿ ××©×™××•×ª ×¤×ª×•×—×•×ª!</p></div>';
    return;
  }
  const frag=document.createDocumentFragment();
  open.forEach(e=>{
    const idx=events.indexOf(e), isMine=(e.owner||e.Owner||'').includes(me);
    const tasks=(e.tasks||e.Tasks||'').split('|').filter(t=>t.trim());
    const card=document.createElement('div');
    card.className='ecard';
    card.style.flexDirection='column';
    card.style.cursor='default';

    const top=document.createElement('div');
    top.style.cssText='display:flex;justify-content:space-between;align-items:center;padding:14px 14px 10px;border-bottom:1px solid var(--border)';
    top.innerHTML=`
      <div style="display:flex;align-items:center;gap:8px">
        <div class="ecard-accent ${isMine?'mine':''}" style="width:3px;height:20px;border-radius:2px;flex-shrink:0"></div>
        <h3 style="font-weight:700;color:var(--ink);font-size:13px">${e.Title||e.title||'â€”'}</h3>
      </div>
      <span style="font-size:11px;color:var(--muted);font-weight:600">ğŸ‘¤ ${e.owner||e.Owner||'-'}</span>`;
    card.appendChild(top);

    const tw=document.createElement('div'); tw.style.cssText='padding:10px 14px;display:flex;flex-direction:column;gap:7px';
    if(tasks.length){
      tasks.forEach(t=>{
        const row=document.createElement('div'); row.className='tr';
        const cb=document.createElement('input'); cb.type='checkbox';
        cb.onchange=()=>row.classList.toggle('done',cb.checked);
        const sp=document.createElement('span'); sp.style.fontSize='13px'; sp.textContent=t;
        row.appendChild(cb); row.appendChild(sp); tw.appendChild(row);
      });
    } else {
      tw.innerHTML='<span style="font-size:11px;color:#cbd5e1;padding:4px 0">××™×Ÿ ××©×™××•×ª ××¤×•×¨×˜×•×ª</span>';
    }
    card.appendChild(tw);

    const foot=document.createElement('div');
    foot.style.cssText='padding:8px 14px 12px;display:flex;justify-content:flex-end';
    const ob=document.createElement('button');
    ob.style.cssText='font-size:11px;font-weight:700;color:var(--blue);background:var(--bg);border:1px solid var(--border);border-radius:8px;padding:5px 12px;cursor:pointer;font-family:Heebo,sans-serif';
    ob.textContent='×¤×ª×— ×¤×¨×•×™×§×˜ â†';
    ob.onclick=()=>openView(idx);
    foot.appendChild(ob); card.appendChild(foot);
    frag.appendChild(card);
  });
  c.appendChild(frag);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEW MODAL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openView(idx) {
  const e=events[idx]; if(!e) return;
  viewIdx=idx;
  id('vT').textContent   = e.Title||e.title||'';
  id('vDateTxt').textContent = fmtEventDate(e.date||e.Date||'');
  id('vOwn').textContent = 'ğŸ‘¤ ' + (e.owner||e.Owner||'â€”');
  id('vDesc').textContent = e.Description||e.description||'××™×Ÿ ×ª×™××•×¨';

  const st = e.status||e.Status||'×—×“×©';
  refreshVSt(st);

  const imgSrc=e.Image||e.image||'';
  if(imgSrc.startsWith('data:image')){ id('vImg').src=imgSrc; id('vImg').style.display='block'; id('vImgPH').style.display='none'; }
  else { id('vImg').style.display='none'; id('vImgPH').style.display='flex'; }

  const tl=id('vtList'); tl.innerHTML='';
  const tasks=(e.tasks||e.Tasks||'').split('|').filter(t=>t.trim());
  if(tasks.length){
    tasks.forEach(t=>{
      const row=document.createElement('div'); row.className='tr';
      const cb=document.createElement('input'); cb.type='checkbox';
      cb.onchange=()=>row.classList.toggle('done',cb.checked);
      const sp=document.createElement('span'); sp.style.fontSize='13px'; sp.textContent=t;
      row.appendChild(cb); row.appendChild(sp); tl.appendChild(row);
    });
  } else {
    tl.innerHTML='<span style="font-size:11px;color:#cbd5e1">××™×Ÿ ××©×™××•×ª ××•×’×“×¨×•×ª</span>';
  }
  showOv('mView');
}

function refreshVSt(st) {
  const map={×—×“×©:'active-n',×‘×˜×™×¤×•×œ:'active-w',×‘×•×¦×¢:'active-d'};
  document.querySelectorAll('.vsb').forEach(b=>{
    b.className='vsb sb'+(b.dataset.v===st?' '+map[b.dataset.v]:'');
  });
  const pill=id('vPill');
  pill.innerHTML=`<span class="${pillClass(st)}">${st}</span>`;
}

function changeSt(st) {
  if(viewIdx<0) return;
  events[viewIdx].status=st; events[viewIdx].Status=st;
  refreshVSt(st); updateStats(); renderList();
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADD MODAL
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openAdd() { fillOwnerSelect(); showOv('mAdd'); }
function closeAdd(){ hide('mAdd'); }

function addRow(cid) {
  const c = id(cid);
  const row = document.createElement('div');
  row.className = 'tr';
  row.style.background = 'white';

  const inp = document.createElement('input');
  inp.type = 'text'; inp.placeholder = '×›×ª×•×‘ ××©×™××”...';
  inp.className = 'task-inp';
  inp.style.cssText = 'flex:1;background:transparent;border:none;outline:none;font-size:13px;font-family:Heebo,sans-serif;color:var(--ink);width:0';
  
  // ××¤×©×¨ Enter ×œ×”×•×¡×™×£ ××©×™××” ×—×“×©×”
  inp.addEventListener('keydown', e => {
    if(e.key === 'Enter' && inp.value.trim()) {
      e.preventDefault();
      const btnId = cid === 'tList' ? 'btnAddTask' : 'btnVAddTask';
      id(btnId).click();
    }
  });

  const del = document.createElement('button');
  del.type = 'button';
  del.style.cssText = 'background:none;border:none;cursor:pointer;padding:2px;color:#fca5a5;flex-shrink:0;display:flex;align-items:center;line-height:1';
  del.innerHTML = '<i data-lucide="x" style="width:16px;height:16px"></i>';
  del.onclick = () => row.remove();

  row.appendChild(inp); row.appendChild(del);
  c.appendChild(row);
  lucide.createIcons(); 
  
  // ××™×§×•×“ ××•×˜×•××˜×™ ×¢× ×¢×™×›×•×‘ ×§×¦×¨ ×›×“×™ ×œ××¤×©×¨ ×œ×× ×™××¦×™×•×ª ×œ×”×¡×ª×™×™×
  setTimeout(() => inp.focus(), 50);
}

function handleImg() {
  const f = id('inImg').files[0]; if(!f) return;
  const r = new FileReader();
  r.onload = ev => {
    if(ev.target.result.length>50000){ alert('×”×ª××•× ×” ×’×“×•×œ×” ××“×™ â€” ×¢×“ ~37KB'); id('inImg').value=''; return; }
    img64 = ev.target.result;
    id('imgSt').textContent='âœ… ×ª××•× ×” × ×‘×—×¨×”';
    id('imgPE').src=img64; id('imgPW').style.display='block';
  };
  r.readAsDataURL(f);
}

async function save() {
  const title  = id('inT').value.trim();
  const dStart = id('inD').value;
  const dEnd   = id('inDEnd').value;
  const owner  = id('inO').value;
  const desc   = id('inDesc').value.trim();
  const status = id('inS').value;
  const tasks  = [...id('tList').querySelectorAll('.task-inp')]
                   .map(x=>x.value.trim()).filter(Boolean).join('|');

  if(!title){ alert('× × ×œ×”×–×™×Ÿ ×©× ××™×¨×•×¢'); return; }

  // ×‘× ×” ×ª××¨×™×š â€” ×× ×™×© ×˜×•×•×—, ×¤×•×¨××˜: D/M/YYYY-D/M/YYYY
  let dateVal = dStart;
  if(dStart && dEnd) {
    const s = parseSingle(dStart.split('-').reverse().join('/')) || new Date(dStart);
    const e = parseSingle(dEnd.split('-').reverse().join('/'))   || new Date(dEnd);
    const fmt = d => `${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()}`;
    dateVal = `${fmt(s)}-${fmt(e)}`;
  } else if(dStart) {
    const s = new Date(dStart);
    dateVal = `${s.getDate()}/${s.getMonth()+1}/${s.getFullYear()}`;
  }

  const btn=id('saveBtn'); btn.textContent='×©×•××¨...'; btn.disabled=true;

  const body=new URLSearchParams({title,date:dateVal,owner,desc,status,tasks,image:img64});
  try { await fetch(POST,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:body.toString()}); }
  catch(e){ console.error(e); }

  events.unshift({Title:title,date:dateVal,Date:dateVal,owner,Owner:owner,Description:desc,status,Status:status,tasks,Tasks:tasks,Image:img64});
  renderAll(); closeAdd(); resetForm();
  setTimeout(()=>loadData(),4000);
  btn.textContent='×©××•×¨ ×•×¡× ×›×¨×Ÿ â†'; btn.disabled=false;
}

function resetForm(){
  ['inT','inD','inDEnd','inDesc'].forEach(x=>id(x).value='');
  id('inO').value=''; id('inS').value='×—×“×©';
  id('tList').innerHTML=''; id('inImg').value='';
  id('imgSt').textContent='×”×•×¡×£ ×ª××•× ×”'; id('imgPW').style.display='none';
  id('sBtns').querySelectorAll('.sb').forEach((b,i)=>{ b.className = i===0?'sb active-n':'sb'; });
  img64='';
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEW SWITCH
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function sv(name){
  ['List','Cal','Tasks'].forEach(v=>{
    id('v'+v).style.display='none';
    const nb=id('nb-'+v.toLowerCase()); if(nb) nb.classList.remove('on');
  });
  id('v'+name).style.display='block';
  const nb=id('nb-'+name.toLowerCase()); if(nb) nb.classList.add('on');
}

function askNotif(){
  Notification.requestPermission().then(p=>alert(p==='granted'?'ğŸ”” ×”×ª×¨××•×ª ×”×•×¤×¢×œ×•!':'×œ× ××•×©×¨'));
}
</script>
</body>
</html>
