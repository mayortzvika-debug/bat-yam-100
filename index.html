<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Bat Yam 100</title>
<meta name="mobile-web-app-capable" content="yes">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<script src="https://unpkg.com/lucide@latest"></script>
<link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">
<style>
:root{--p:#0077b6;--d:#023e8a}
*{box-sizing:border-box}
body{background:#f0f9ff;font-family:'Heebo',sans-serif;padding-bottom:100px;-webkit-tap-highlight-color:transparent;overscroll-behavior-y:none}

/* HERO */
.hero{position:relative;height:220px;border-radius:0 0 36px 36px;overflow:hidden;background:linear-gradient(145deg,var(--p),var(--d));box-shadow:0 16px 40px -12px rgba(0,119,182,0.5)}
.hero-bg{background-image:url('baner.jpg');background-size:cover;background-position:center;position:absolute;inset:0;opacity:.75}
.hero-ov{position:absolute;inset:0;background:linear-gradient(to bottom,rgba(0,30,80,.25),rgba(0,20,60,.65))}
.hero-c{position:relative;z-index:2;padding:20px;height:100%;display:flex;flex-direction:column;justify-content:space-between}
.glass{background:rgba(255,255,255,.18);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.3);color:white;border-radius:50px;display:inline-flex;align-items:center;gap:6px;cursor:pointer;padding:8px 14px;font-size:12px;font-weight:700}
.glass:active{transform:scale(.93)}
.glass-ic{background:rgba(255,255,255,.18);backdrop-filter:blur(12px);-webkit-backdrop-filter:blur(12px);border:1px solid rgba(255,255,255,.3);color:white;border-radius:50%;width:36px;height:36px;display:flex;align-items:center;justify-content:center;cursor:pointer}
.glass-ic:active{transform:scale(.93)}

/* CARD */
.card{background:white;border-radius:18px;box-shadow:0 2px 12px rgba(0,0,0,.055);border:1px solid rgba(0,119,182,.07);transition:transform .15s;cursor:pointer}
.card:active{transform:scale(.97)}

/* NAV */
.nav{position:fixed;bottom:20px;left:16px;right:16px;background:rgba(255,255,255,.96);backdrop-filter:blur(16px);padding:8px 12px;border-radius:26px;display:flex;justify-content:space-between;align-items:center;box-shadow:0 12px 40px -8px rgba(0,0,0,.15);border:1px solid rgba(255,255,255,.5);z-index:40}
.nb{padding:10px 12px;border-radius:16px;color:#94a3b8;display:flex;flex-direction:column;align-items:center;gap:3px;font-size:9px;font-weight:700;transition:all .2s;background:none;border:none;cursor:pointer}
.nb.on{color:var(--p);background:#e0f2fe}
.nadd{background:linear-gradient(135deg,var(--p),var(--d));color:white;padding:13px;border-radius:22px;box-shadow:0 8px 20px -4px rgba(0,119,182,.5);transform:translateY(-16px);border:4px solid white;cursor:pointer}
.nadd:active{transform:translateY(-16px) scale(.93)}

/* PILLS */
.pn{background:#dbeafe;color:#1d4ed8}
.pa{background:#fef3c7;color:#b45309}
.pd{background:#dcfce7;color:#16a34a}

/* CALENDAR */
.cday{min-height:66px;background:white;border-radius:9px;border:1px solid #e0f2fe;padding:3px;overflow:hidden}
.cday.tod{border:2px solid var(--p);background:#f0f9ff}
.cemp{min-height:66px;background:#f8fafc;opacity:.3;border-radius:9px}
.cev{background:var(--p);color:white;padding:2px 3px;border-radius:3px;margin-top:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;font-size:8px;font-weight:700;display:block;cursor:pointer}
.cev.mine{background:#16a34a}
.cnum{font-size:11px;font-weight:800;display:block}

/* STAT */
.sc{background:white;border-radius:16px;padding:12px 14px;border:1px solid rgba(0,119,182,.08);box-shadow:0 2px 8px rgba(0,0,0,.04)}

/* OVERLAY / SHEET */
.ov{position:fixed;inset:0;background:rgba(15,23,42,.6);display:flex;align-items:flex-end;justify-content:center;z-index:150;backdrop-filter:blur(4px)}
.sh{background:white;width:100%;max-width:480px;border-radius:30px 30px 0 0;display:flex;flex-direction:column;max-height:92vh;animation:up .3s cubic-bezier(.16,1,.3,1)}
@keyframes up{from{transform:translateY(100%)}to{transform:translateY(0)}}

/* LOGIN */
.lw{position:fixed;inset:0;background:#0f172a;z-index:200;display:flex;align-items:center;justify-content:center;padding:20px}
.lb{background:white;border-radius:26px;padding:32px 24px;width:100%;max-width:340px;text-align:center;animation:pop .35s cubic-bezier(.16,1,.3,1)}
@keyframes pop{from{transform:scale(.85);opacity:0}to{transform:scale(1);opacity:1}}
.chip{padding:9px 18px;border-radius:50px;border:2px solid #e2e8f0;cursor:pointer;font-weight:700;font-size:14px;background:white;transition:all .15s;font-family:'Heebo',sans-serif}
.chip:hover,.chip.sel{border-color:var(--p);background:#e0f2fe;color:var(--p)}

/* TASK ROW */
.tr{display:flex;align-items:center;gap:10px;padding:9px 12px;background:#f8fafc;border-radius:10px}
.tr input[type=checkbox]{width:17px;height:17px;accent-color:var(--p);cursor:pointer;flex-shrink:0}
.tr.done span{text-decoration:line-through;color:#94a3b8}

/* LOADER */
#ldr{position:fixed;inset:0;background:white;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;transition:opacity .4s}
.badge{position:absolute;top:6px;right:6px;width:9px;height:9px;background:#ef4444;border-radius:50%;border:2px solid white}
.sh-hide::-webkit-scrollbar{display:none}.sh-hide{-ms-overflow-style:none;scrollbar-width:none}

/* FIELD */
.fld{width:100%;padding:12px 14px;background:#f8fafc;border-radius:12px;border:1.5px solid #e2e8f0;outline:none;font-family:'Heebo',sans-serif;font-size:14px;transition:border-color .2s}
.fld:focus{border-color:var(--p);background:white}
.fld-lg{font-size:17px;font-weight:700;padding:14px}
</style>
</head>
<body>

<!-- LOADER -->
<div id="ldr">
  <div style="position:relative;margin-bottom:16px">
    <div style="width:56px;height:56px;border:4px solid #f1f5f9;border-top-color:#2563eb;border-radius:50%;animation:spin 1s linear infinite"></div>
    <div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-weight:900;color:#2563eb;font-size:11px">100</div>
  </div>
  <p style="color:#94a3b8;font-size:11px;font-weight:700;letter-spacing:.1em">×˜×•×¢×Ÿ...</p>
</div>
<style>@keyframes spin{to{transform:rotate(360deg)}}</style>

<!-- LOGIN -->
<div id="lw" class="lw" style="display:none">
  <div class="lb">
    <div style="width:72px;height:72px;background:#eff6ff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:36px;margin:0 auto 16px">ğŸ‘‹</div>
    <h2 style="font-size:22px;font-weight:900;color:#1e293b;margin-bottom:4px">×‘×¨×•×›×™× ×”×‘××™×</h2>
    <p style="color:#94a3b8;font-size:13px;margin-bottom:20px">××™ ××ª/×”?</p>
    <div id="lchips" style="display:flex;flex-wrap:wrap;gap:8px;justify-content:center;margin-bottom:16px"></div>
    <input id="lname" type="text" placeholder="×©× ××—×¨..." class="fld" style="text-align:center;margin-bottom:14px">
    <button id="lbtn" style="width:100%;background:#2563eb;color:white;padding:14px;border-radius:12px;font-weight:900;font-size:15px;border:none;cursor:pointer;font-family:'Heebo',sans-serif">×›× ×™×¡×” â†’</button>
  </div>
</div>

<!-- APP -->
<div id="app" style="display:none" class="max-w-md mx-auto">

  <!-- HERO -->
  <div class="hero">
    <div class="hero-bg"></div>
    <div class="hero-ov"></div>
    <div class="hero-c">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <button id="btnUser" class="glass">
          <span style="width:8px;height:8px;border-radius:50%;background:#4ade80;animation:pulse 2s infinite;flex-shrink:0"></span>
          <span id="uLabel">××•×¨×—</span>
          <i data-lucide="settings" style="width:12px;height:12px;opacity:.7"></i>
        </button>
        <div style="display:flex;gap:8px">
          <button id="btnNotif" class="glass-ic"><i data-lucide="bell" style="width:18px;height:18px"></i></button>
          <button id="btnRefresh" class="glass-ic"><i data-lucide="refresh-cw" style="width:18px;height:18px"></i></button>
        </div>
      </div>
      <div>
        <h1 style="font-size:38px;font-weight:900;letter-spacing:-1px;color:white;line-height:1;margin-bottom:4px;text-shadow:0 2px 8px rgba(0,0,0,.3)">BAT YAM <span style="color:#fde047">100</span></h1>
        <p style="color:rgba(219,234,254,.9);font-size:13px;font-weight:500">× ×™×”×•×œ ×¤×¨×•×™×§×˜×™× Â· 2026</p>
      </div>
    </div>
  </div>

  <div style="padding:20px 16px 0">

    <!-- LIST VIEW -->
    <div id="vList">
      <div style="display:flex;gap:12px;margin-bottom:20px;overflow-x:auto" class="sh-hide">
        <div class="sc" style="flex:1;min-width:100px"><span style="font-size:10px;color:#94a3b8;font-weight:700;display:block;margin-bottom:4px">×¡×”"×›</span><span id="stT" style="font-size:30px;font-weight:900;color:#1e293b">0</span></div>
        <div class="sc" style="flex:1;min-width:100px;background:#f0fdf4;border-color:#bbf7d0"><span style="font-size:10px;color:#16a34a;font-weight:700;display:block;margin-bottom:4px">×©×œ×™</span><span id="stM" style="font-size:30px;font-weight:900;color:#15803d">0</span></div>
        <div class="sc" style="flex:1;min-width:100px;background:#fffbeb;border-color:#fde68a"><span style="font-size:10px;color:#b45309;font-weight:700;display:block;margin-bottom:4px">×‘×˜×™×¤×•×œ</span><span id="stA" style="font-size:30px;font-weight:900;color:#92400e">0</span></div>
      </div>
      <p style="font-size:13px;font-weight:900;color:#475569;margin-bottom:12px">×›×œ ×”×¤×¨×•×™×§×˜×™×</p>
      <div id="eCards" style="display:flex;flex-direction:column;gap:12px;padding-bottom:112px"></div>
    </div>

    <!-- CALENDAR VIEW -->
    <div id="vCal" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h2 id="calTit" style="font-size:14px;font-weight:900;color:#1e293b"></h2>
        <div style="display:flex;gap:8px">
          <button id="calP" style="padding:8px;background:white;border-radius:50%;border:1px solid #e2e8f0;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.06)"><i data-lucide="chevron-right" style="width:16px;height:16px"></i></button>
          <button id="calN" style="padding:8px;background:white;border-radius:50%;border:1px solid #e2e8f0;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.06)"><i data-lucide="chevron-left" style="width:16px;height:16px"></i></button>
        </div>
      </div>
      <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:4px;text-align:center;font-size:9px;font-weight:900;color:#94a3b8;margin-bottom:4px">
        <div>××³</div><div>×‘×³</div><div>×’×³</div><div>×“×³</div><div>×”×³</div><div>×•×³</div><div>×©×³</div>
      </div>
      <div id="calG" style="display:grid;grid-template-columns:repeat(7,1fr);gap:3px;padding-bottom:112px"></div>
    </div>

    <!-- TASKS VIEW -->
    <div id="vTasks" style="display:none">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <p style="font-size:13px;font-weight:900;color:#475569">××©×™××•×ª ×¤×ª×•×—×•×ª</p>
        <select id="tFilter" style="font-size:11px;font-weight:700;background:white;border:1.5px solid #e2e8f0;border-radius:12px;padding:6px 12px;outline:none;font-family:'Heebo',sans-serif"><option value="">×›×•×œ×</option></select>
      </div>
      <div id="tCards" style="display:flex;flex-direction:column;gap:12px;padding-bottom:112px"></div>
    </div>

  </div>

  <!-- NAV -->
  <div class="nav">
    <button id="nb-list" class="nb on"><i data-lucide="home" style="width:20px;height:20px"></i><span>×‘×™×ª</span></button>
    <button id="nb-tasks" class="nb" style="position:relative"><i data-lucide="check-square" style="width:20px;height:20px"></i><span>××©×™××•×ª</span><span id="tbadge" class="badge" style="display:none"></span></button>
    <button id="nb-add" class="nadd"><i data-lucide="plus" style="width:28px;height:28px"></i></button>
    <button id="nb-cal" class="nb"><i data-lucide="calendar" style="width:20px;height:20px"></i><span>×œ×•×— ×©× ×”</span></button>
    <button id="nb-set" class="nb"><i data-lucide="user" style="width:20px;height:20px"></i><span>×¤×¨×•×¤×™×œ</span></button>
  </div>
</div>

<!-- ADD MODAL -->
<div id="mAdd" class="ov" style="display:none">
  <div class="sh" style="height:90vh">
    <div style="padding:20px;display:flex;justify-content:space-between;align-items:center;border-bottom:1px solid #f1f5f9;flex-shrink:0">
      <h2 style="font-size:20px;font-weight:900;color:#1e293b">×¤×¨×•×™×§×˜ ×—×“×©</h2>
      <button id="mAddClose" style="padding:8px;background:#f8fafc;border-radius:50%;border:none;cursor:pointer"><i data-lucide="x" style="width:18px;height:18px;color:#94a3b8"></i></button>
    </div>
    <div style="flex:1;overflow-y:auto;padding:20px;display:flex;flex-direction:column;gap:16px">

      <div>
        <label style="font-size:10px;font-weight:900;color:#94a3b8;text-transform:uppercase;display:block;margin-bottom:6px">×©× ×”××™×¨×•×¢ *</label>
        <input id="inT" type="text" class="fld fld-lg" placeholder="×©× ×”××™×¨×•×¢">
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div>
          <label style="font-size:10px;font-weight:900;color:#94a3b8;text-transform:uppercase;display:block;margin-bottom:6px">×ª××¨×™×š</label>
          <input id="inD" type="date" class="fld">
        </div>
        <div>
          <label style="font-size:10px;font-weight:900;color:#94a3b8;text-transform:uppercase;display:block;margin-bottom:6px">××—×¨××™</label>
          <select id="inO" class="fld">
            <option value="">×‘×—×¨ ××—×¨××™...</option>
          </select>
        </div>
      </div>

      <div>
        <label style="font-size:10px;font-weight:900;color:#94a3b8;text-transform:uppercase;display:block;margin-bottom:6px">×¡×˜×˜×•×¡</label>
        <div id="sBtns" style="display:flex;gap:8px">
          <button class="sb" data-v="×—×“×©" style="flex:1;padding:8px;border-radius:12px;font-weight:700;font-size:13px;border:2px solid #93c5fd;background:#dbeafe;color:#1d4ed8;cursor:pointer;font-family:'Heebo',sans-serif">×—×“×©</button>
          <button class="sb" data-v="×‘×˜×™×¤×•×œ" style="flex:1;padding:8px;border-radius:12px;font-weight:700;font-size:13px;border:2px solid #e2e8f0;background:#f8fafc;color:#94a3b8;cursor:pointer;font-family:'Heebo',sans-serif">×‘×˜×™×¤×•×œ</button>
          <button class="sb" data-v="×‘×•×¦×¢" style="flex:1;padding:8px;border-radius:12px;font-weight:700;font-size:13px;border:2px solid #e2e8f0;background:#f8fafc;color:#94a3b8;cursor:pointer;font-family:'Heebo',sans-serif">×‘×•×¦×¢</button>
        </div>
        <input type="hidden" id="inS" value="×—×“×©">
      </div>

      <div>
        <label style="font-size:10px;font-weight:900;color:#94a3b8;text-transform:uppercase;display:block;margin-bottom:6px">×ª×™××•×¨</label>
        <textarea id="inDesc" rows="3" class="fld" style="resize:none"></textarea>
      </div>

      <div style="background:#f8fafc;padding:16px;border-radius:14px;border:1px solid #f1f5f9">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <label style="font-size:10px;font-weight:900;color:#94a3b8;text-transform:uppercase">××©×™××•×ª</label>
          <button id="btnAddTask" style="color:#2563eb;font-size:12px;font-weight:700;background:none;border:none;cursor:pointer;font-family:'Heebo',sans-serif;padding:4px 8px">+ ×”×•×¡×£ ××©×™××”</button>
        </div>
        <div id="tList" style="display:flex;flex-direction:column;gap:8px"></div>
      </div>

      <label style="display:flex;align-items:center;gap:12px;padding:14px;border:2px dashed #e2e8f0;border-radius:14px;cursor:pointer">
        <input type="file" id="inImg" style="display:none" accept="image/*">
        <i data-lucide="image-plus" style="width:20px;height:20px;color:#cbd5e1;flex-shrink:0"></i>
        <div>
          <span id="imgSt" style="font-size:13px;font-weight:700;color:#64748b;display:block">×”×•×¡×£ ×ª××•× ×” (××•×¤×¦×™×•× ×œ×™)</span>
          <span style="font-size:10px;color:#94a3b8">×¢×“ ~37KB</span>
        </div>
      </label>
      <div id="imgPW" style="display:none;height:140px;border-radius:12px;overflow:hidden;border:1px solid #e2e8f0">
        <img id="imgPE" style="width:100%;height:100%;object-fit:cover">
      </div>

    </div>
    <div style="padding:16px;border-top:1px solid #f1f5f9;flex-shrink:0">
      <button id="saveBtn" style="width:100%;background:#2563eb;color:white;padding:16px;border-radius:14px;font-weight:900;font-size:16px;border:none;cursor:pointer;font-family:'Heebo',sans-serif;box-shadow:0 4px 14px rgba(37,99,235,.4)">×©××•×¨ ×•×¡× ×›×¨×Ÿ â†</button>
    </div>
  </div>
</div>

<!-- VIEW MODAL -->
<div id="mView" class="ov" style="display:none">
  <div class="sh" style="height:88vh">
    <div style="height:176px;background:#f1f5f9;position:relative;flex-shrink:0">
      <img id="vImg" style="width:100%;height:100%;object-fit:cover;display:none">
      <div id="vImgPH" style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;background:linear-gradient(135deg,#eff6ff,#f1f5f9)">
        <i data-lucide="image" style="width:48px;height:48px;color:#e2e8f0"></i>
      </div>
      <button id="mViewClose" style="position:absolute;top:14px;left:14px;background:rgba(0,0,0,.3);color:white;padding:8px;border-radius:50%;border:none;cursor:pointer;backdrop-filter:blur(4px)"><i data-lucide="x" style="width:18px;height:18px"></i></button>
      <div id="vPill" style="position:absolute;bottom:14px;right:14px;padding:4px 12px;border-radius:50px;font-size:11px;font-weight:900;box-shadow:0 2px 8px rgba(0,0,0,.15)"></div>
    </div>
    <div style="flex:1;overflow-y:auto;padding:20px">
      <h2 id="vT" style="font-size:22px;font-weight:900;color:#1e293b;margin-bottom:6px;line-height:1.3"></h2>
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:16px">
        <span id="vDate" style="background:#eff6ff;color:#2563eb;font-weight:700;padding:2px 8px;border-radius:6px;font-size:11px"></span>
        <span style="color:#e2e8f0">Â·</span>
        <span id="vOwn" style="color:#64748b;font-weight:600;font-size:12px"></span>
      </div>
      <!-- View status btns -->
      <div id="vsBtns" style="display:flex;gap:8px;margin-bottom:16px">
        <button class="vsb" data-v="×—×“×©" style="flex:1;padding:8px;border-radius:12px;font-weight:700;font-size:12px;border:2px solid;cursor:pointer;font-family:'Heebo',sans-serif">×—×“×©</button>
        <button class="vsb" data-v="×‘×˜×™×¤×•×œ" style="flex:1;padding:8px;border-radius:12px;font-weight:700;font-size:12px;border:2px solid;cursor:pointer;font-family:'Heebo',sans-serif">×‘×˜×™×¤×•×œ</button>
        <button class="vsb" data-v="×‘×•×¦×¢" style="flex:1;padding:8px;border-radius:12px;font-weight:700;font-size:12px;border:2px solid;cursor:pointer;font-family:'Heebo',sans-serif">×‘×•×¦×¢</button>
      </div>
      <p id="vDesc" style="font-size:13px;color:#475569;line-height:1.6;background:#f8fafc;padding:14px;border-radius:12px;margin-bottom:16px"></p>
      <div style="background:#f8fafc;padding:16px;border-radius:14px;border:1px solid #f1f5f9;margin-bottom:16px">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <span style="font-size:10px;font-weight:900;color:#94a3b8;text-transform:uppercase">××©×™××•×ª</span>
          <button id="btnVAddTask" style="color:#2563eb;font-size:12px;font-weight:700;background:none;border:none;cursor:pointer;font-family:'Heebo',sans-serif;padding:4px 8px">+ ×”×•×¡×£</button>
        </div>
        <div id="vtList" style="display:flex;flex-direction:column;gap:8px"></div>
      </div>
    </div>
  </div>
</div>

<!-- SETTINGS MODAL -->
<div id="mSet" class="ov" style="display:none">
  <div class="sh" style="padding:28px;border-radius:30px 30px 0 0;max-height:70vh">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:20px">
      <h2 style="font-size:20px;font-weight:900;color:#1e293b">×”×’×“×¨×•×ª</h2>
      <button id="mSetClose" style="padding:8px;background:#f8fafc;border-radius:50%;border:none;cursor:pointer"><i data-lucide="x" style="width:18px;height:18px;color:#94a3b8"></i></button>
    </div>
    <p style="font-size:11px;font-weight:900;color:#94a3b8;text-transform:uppercase;margin-bottom:12px">×”×—×œ×£ ××©×ª××©</p>
    <div id="schips" style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:16px"></div>
    <input id="sname" type="text" placeholder="×©× ××—×¨..." class="fld" style="text-align:center;margin-bottom:14px">
    <button id="btnSwitch" style="width:100%;background:#2563eb;color:white;padding:12px;border-radius:12px;font-weight:900;border:none;cursor:pointer;font-family:'Heebo',sans-serif">×”×—×œ×£</button>
  </div>
</div>

<script>
// â”€â”€â”€ CONFIG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CSV  = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ02cU8av1KtchNykwq-QxjU6LiLZx-CSp5B28BxAgnsvJjlTwMMW1QO8qNylEYC78qDQFT_S3-fzUA/pub?output=csv";
const POST = "https://script.google.com/macros/s/AKfycbxpdgCT9MgQGJbGRJupmNpEZOxSlWBi99GrAznCFVUM7NsMKytt4gjquKR333sTb62vbg/exec";

// â”€â”€ ×›×œ ×”×‘×¢×œ×™× â€” ×™×©×œ×¤×• ×’× ××”×’×™×œ×™×•×Ÿ ×‘×–××Ÿ ×˜×¢×™× ×”
let OWNERS = ['×‘×Ÿ','×¨×™× ×ª','×’×œ×™×ª','××‘×™×©×™','××•×¨','×™×•×¡×™','×¨×•×ª×'];

// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let events = [];
let me = localStorage.getItem('batyam_user') || '';
let calY = new Date().getFullYear(), calM = new Date().getMonth();
let img64 = '', viewIdx = -1;

// â”€â”€â”€ BOOT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('DOMContentLoaded', () => {
  lucide.createIcons();
  wire();
  me ? boot() : showLogin();
});

function showLogin() {
  hide('ldr'); show('lw');
  buildChips('lchips');
}

function boot() {
  id('uLabel').textContent = me;
  show('app');
  loadData();
}

// â”€â”€â”€ WIRE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wire() {
  // Login
  id('lbtn').onclick = doLogin;
  id('lname').onkeydown = e => { if(e.key==='Enter') doLogin(); };

  // Nav
  id('nb-list').onclick  = () => sv('List');
  id('nb-cal').onclick   = () => sv('Cal');
  id('nb-tasks').onclick = () => sv('Tasks');
  id('nb-add').onclick   = openAdd;
  id('nb-set').onclick   = openSet;
  id('btnUser').onclick  = openSet;
  id('btnRefresh').onclick = () => loadData(true);
  id('btnNotif').onclick = askNotif;

  // Add modal
  id('mAddClose').onclick = closeAdd;
  id('btnAddTask').onclick = () => addRow('tList');    // ×”×•×¡×£ ××©×™××”
  id('saveBtn').onclick = save;
  id('inImg').onchange = handleImg;

  // Status in add
  id('sBtns').onclick = e => {
    const b = e.target.closest('.sb'); if(!b) return;
    id('inS').value = b.dataset.v;
    id('sBtns').querySelectorAll('.sb').forEach(x => setSbInactive(x));
    setSbActive(b);
  };

  // View modal
  id('mViewClose').onclick = () => hide('mView');
  id('btnVAddTask').onclick = () => addRow('vtList');  // ×”×•×¡×£ ××©×™××” ×‘×ª×¦×•×’×”
  id('vsBtns').onclick = e => {
    const b = e.target.closest('.vsb'); if(b) changeSt(b.dataset.v);
  };

  // Settings
  id('mSetClose').onclick = () => hide('mSet');
  id('btnSwitch').onclick = doSwitch;

  // Task filter
  id('tFilter').onchange = renderTasks;

  // Calendar nav
  id('calP').onclick = () => { calM--; if(calM<0){calM=11;calY--;} renderCal(); };
  id('calN').onclick = () => { calM++; if(calM>11){calM=0;calY++;} renderCal(); };

  // Backdrop close
  ['mAdd','mView','mSet'].forEach(x => {
    id(x).onclick = e => { if(e.target.id===x) hide(x); };
  });
}

// â”€â”€â”€ HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const id = x => document.getElementById(x);
function show(x){ id(x).style.display='block'; }
function hide(x){ id(x).style.display='none'; }
function showOv(x){ id(x).style.display='flex'; lucide.createIcons(); }

// â”€â”€â”€ LOGIN â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildChips(cid) {
  const c = id(cid); c.innerHTML='';
  OWNERS.forEach(n => {
    const b = document.createElement('button');
    b.className = 'chip' + (n===me?' sel':'');
    b.textContent = n;
    b.onclick = () => { c.querySelectorAll('.chip').forEach(x=>x.classList.remove('sel')); b.classList.add('sel'); };
    c.appendChild(b);
  });
}

function getChip(cid, iid) {
  const s = document.querySelector(`#${cid} .chip.sel`);
  if(s) return s.textContent;
  return id(iid)?.value.trim() || '';
}

function doLogin() {
  const n = getChip('lchips','lname');
  if(!n){ alert('×‘×—×¨/×™ ×©×'); return; }
  localStorage.setItem('batyam_user', n);
  me = n; hide('lw'); boot();
}

function openSet() { buildChips('schips'); showOv('mSet'); }

function doSwitch() {
  const n = getChip('schips','sname');
  if(!n){ alert('×‘×—×¨ ×©×'); return; }
  localStorage.setItem('batyam_user', n);
  me = n; id('uLabel').textContent = n;
  renderAll(); hide('mSet');
}

// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadData(manual=false) {
  if(manual){ id('ldr').style.cssText='position:fixed;inset:0;background:white;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;opacity:1'; }
  try {
    const r = await fetch(CSV+'&t='+Date.now());
    const t = await r.text();
    Papa.parse(t, { header:true, skipEmptyLines:true, complete: res => {
      events = res.data.filter(e => e.Title || e.title);  // ×¡× ×Ÿ ×©×•×¨×•×ª ×¨×™×§×•×ª

      // â”€â”€ ×—×œ×¥ ×‘×¢×œ×™× ×™×™×—×•×“×™×™× ××”×’×™×œ×™×•×Ÿ ×•×¢×“×›×Ÿ ×¨×©×™××”
      const sheetOwners = [...new Set(
        events.map(e => (e.owner||e.Owner||'').trim()).filter(Boolean)
              .flatMap(o => o.split('+').map(x=>x.trim())).filter(Boolean)
      )];
      if(sheetOwners.length) {
        // ××–×’ ×¢× ×”-defaults
        sheetOwners.forEach(o => { if(!OWNERS.includes(o)) OWNERS.push(o); });
      }

      // ×¢×“×›×Ÿ dropdown ××—×¨××™ ×‘×˜×•×¤×¡ ×”×•×¡×¤×”
      fillOwnerSelect();

      renderAll();
      hideLoader();
    }});
  } catch(e){ console.error(e); hideLoader(); }
}

function fillOwnerSelect() {
  const sel = id('inO');
  const cur = sel.value;
  sel.innerHTML = '<option value="">×‘×—×¨ ××—×¨××™...</option>';
  OWNERS.forEach(o => {
    const opt = document.createElement('option');
    opt.value=o; opt.textContent=o;
    if(o===cur) opt.selected=true;
    sel.appendChild(opt);
  });
}

function hideLoader() {
  const l = id('ldr');
  l.style.opacity='0';
  setTimeout(()=>{ l.style.display='none'; }, 420);
}

function renderAll() {
  renderList(); renderCal(); renderTasks(); updateStats(); buildFilter();
  lucide.createIcons();
}

// â”€â”€â”€ DATE UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ×’×™×œ×™×•×Ÿ: ×ª××¨×™×›×™× ×‘×¤×•×¨××˜ D/M/YYYY (×œ××©×œ 1/7/2026)
function parseDate(str) {
  if(!str) return null;
  str = str.trim();
  // D/M/YYYY ××• DD/MM/YYYY
  const m1 = str.match(/^(\d{1,2})\/(\d{1,2})\/(\d{4})$/);
  if(m1) return new Date(+m1[3], +m1[2]-1, +m1[1]);
  // YYYY-MM-DD
  const m2 = str.match(/^(\d{4})-(\d{2})-(\d{2})$/);
  if(m2) return new Date(+m2[1], +m2[2]-1, +m2[3]);
  return null;
}

function dateMatches(evDateStr, y, m, d) {
  const dt = parseDate(evDateStr);
  if(!dt) return false;
  return dt.getFullYear()===y && dt.getMonth()===m && dt.getDate()===d;
}

function fmtDate(str) {
  const d = parseDate(str);
  if(!d) return str||'';
  return d.toLocaleDateString('he-IL',{day:'numeric',month:'long',year:'numeric'});
}

// â”€â”€â”€ STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats() {
  id('stT').textContent = events.length;
  id('stM').textContent = events.filter(e=>(e.owner||e.Owner||'').includes(me)).length;
  id('stA').textContent = events.filter(e=>(e.status||e.Status||'').includes('×˜×™×¤×•×œ')).length;
  const myOpen = events.filter(e=>(e.owner||e.Owner||'').includes(me)&&(e.status||e.Status||'')!=='×‘×•×¦×¢').length;
  id('tbadge').style.display = myOpen>0?'block':'none';
}

// â”€â”€â”€ LIST â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderList() {
  const c=id('eCards'); c.innerHTML='';
  if(!events.length){ c.innerHTML='<p style="text-align:center;color:#94a3b8;padding:64px 0">××™×Ÿ ×¤×¨×•×™×§×˜×™× ×¢×“×™×™×Ÿ</p>'; return; }
  const frag=document.createDocumentFragment();
  [...events].map((e,i)=>({e,i})).reverse().forEach(({e,i})=>{
    const title  = e.Title||e.title||'×œ×œ× ×©×';
    const date   = e.date||e.Date||'';
    const owner  = e.owner||e.Owner||'-';
    const status = e.status||e.Status||'×—×“×©';
    const isMine = owner.includes(me);
    const dt = parseDate(date);
    const day = dt ? dt.getDate() : '?';
    const pillCls = status.includes('×‘×•×¦×¢')?'pd':status.includes('×˜×™×¤×•×œ')||status.includes('×ª×”×œ×™×š')||status.includes('×××ª×™×Ÿ')?'pa':'pn';

    const div=document.createElement('div');
    div.className='card';
    div.style.cssText=`padding:16px;display:flex;align-items:center;gap:14px;border-right:4px solid ${isMine?'#22c55e':'transparent'}`;
    div.innerHTML=`
      <div style="width:52px;height:52px;background:#eff6ff;border-radius:14px;display:flex;flex-direction:column;align-items:center;justify-content:center;border:1px solid #bfdbfe;flex-shrink:0">
        <span style="font-size:20px;font-weight:900;color:#2563eb;line-height:1">${day}</span>
        <span style="font-size:8px;color:#93c5fd;font-weight:700;margin-top:1px">×—×•×“×©</span>
      </div>
      <div style="flex:1;min-width:0">
        <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:8px;margin-bottom:4px">
          <h3 style="font-weight:700;color:#1e293b;font-size:14px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${title}</h3>
          <span class="${pillCls}" style="font-size:10px;font-weight:900;padding:2px 8px;border-radius:50px;flex-shrink:0;white-space:nowrap">${status}</span>
        </div>
        <span style="font-size:11px;color:#94a3b8">ğŸ‘¤ ${owner}${isMine?' <b style="color:#16a34a">Â· ×©×œ×™</b>':''}</span>
      </div>`;
    div.addEventListener('click',()=>openView(i));
    frag.appendChild(div);
  });
  c.appendChild(frag);
}

// â”€â”€â”€ CALENDAR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderCal() {
  const g=id('calG'); g.innerHTML='';
  id('calTit').textContent=new Date(calY,calM,1).toLocaleDateString('he-IL',{month:'long',year:'numeric'});

  const firstDay = new Date(calY,calM,1).getDay();   // 0=×¨××©×•×Ÿ
  const days     = new Date(calY,calM+1,0).getDate();
  const today    = new Date();

  // ×ª××™× ×¨×™×§×™×
  for(let i=0;i<firstDay;i++){
    const b=document.createElement('div'); b.className='cemp'; g.appendChild(b);
  }

  for(let d=1;d<=days;d++){
    const isToday = d===today.getDate()&&calM===today.getMonth()&&calY===today.getFullYear();
    const cell=document.createElement('div');
    cell.className='cday'+(isToday?' tod':'');

    const num=document.createElement('span');
    num.className='cnum';
    num.style.color = isToday?'#0077b6':'#64748b';
    num.textContent = d;
    cell.appendChild(num);

    // ×—×™×¤×•×© ××™×¨×•×¢×™× ×œ×¤×™ ×ª××¨×™×š
    events.forEach((e,idx)=>{
      const evDate = e.date||e.Date||'';
      if(!dateMatches(evDate,calY,calM,d)) return;
      const isMine=(e.owner||e.Owner||'').includes(me);
      const ev=document.createElement('span');
      ev.className='cev'+(isMine?' mine':'');
      ev.textContent=e.Title||e.title||'â€”';
      ev.onclick=evt=>{ evt.stopPropagation(); openView(idx); };
      cell.appendChild(ev);
    });
    g.appendChild(cell);
  }
}

// â”€â”€â”€ TASKS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function buildFilter() {
  const sel=id('tFilter'), cur=sel.value;
  const owners=[...new Set(events.map(e=>(e.owner||e.Owner||'').trim()).filter(Boolean))];
  sel.innerHTML='<option value="">×›×•×œ×</option>';
  owners.forEach(o=>{
    const opt=document.createElement('option');
    opt.value=o; opt.textContent=o;
    if(o===cur) opt.selected=true;
    sel.appendChild(opt);
  });
}

function renderTasks() {
  const c=id('tCards'); c.innerHTML='';
  const filter=id('tFilter').value;
  const open=events.filter(e=>{
    const st=e.status||e.Status||'';
    if(st==='×‘×•×¦×¢') return false;
    if(filter&&!(e.owner||e.Owner||'').includes(filter)) return false;
    return true;
  });
  if(!open.length){
    c.innerHTML='<div style="text-align:center;padding:64px 0"><p style="font-size:36px;margin-bottom:8px">ğŸ‰</p><p style="color:#94a3b8;font-weight:600">××™×Ÿ ××©×™××•×ª ×¤×ª×•×—×•×ª!</p></div>';
    return;
  }
  const frag=document.createDocumentFragment();
  open.forEach(e=>{
    const idx=events.indexOf(e), isMine=(e.owner||e.Owner||'').includes(me);
    const tasks=(e.tasks||e.Tasks||e.task||'').split('|').filter(t=>t.trim());
    const card=document.createElement('div');
    card.className='card';
    card.style.cssText=`padding:16px;border-right:4px solid ${isMine?'#22c55e':'#bfdbfe'}`;

    const hdr=document.createElement('div');
    hdr.style.cssText='display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding-bottom:10px;border-bottom:1px solid #f8fafc';
    hdr.innerHTML=`<h3 style="font-weight:700;color:#1e293b;font-size:13px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${e.Title||e.title||'â€”'}</h3><span style="font-size:10px;color:#94a3b8;flex-shrink:0;margin-right:8px">ğŸ‘¤ ${e.owner||e.Owner||'-'}</span>`;
    card.appendChild(hdr);

    const tw=document.createElement('div'); tw.style.cssText='display:flex;flex-direction:column;gap:6px;margin-bottom:10px';
    if(tasks.length){
      tasks.forEach(t=>{
        const row=document.createElement('div'); row.className='tr';
        const cb=document.createElement('input'); cb.type='checkbox';
        cb.onchange=()=>row.classList.toggle('done',cb.checked);
        const sp=document.createElement('span'); sp.style.fontSize='13px'; sp.textContent=t;
        row.appendChild(cb); row.appendChild(sp); tw.appendChild(row);
      });
    } else {
      tw.innerHTML='<span style="font-size:11px;color:#cbd5e1">××™×Ÿ ××©×™××•×ª ××¤×•×¨×˜×•×ª</span>';
    }
    card.appendChild(tw);

    const ob=document.createElement('button');
    ob.style.cssText='font-size:12px;font-weight:700;color:#2563eb;background:none;border:none;cursor:pointer;font-family:Heebo,sans-serif;padding:0';
    ob.textContent='×¤×ª×— ×¤×¨×•×™×§×˜ â†';
    ob.onclick=()=>openView(idx);
    card.appendChild(ob);
    frag.appendChild(card);
  });
  c.appendChild(frag);
}

// â”€â”€â”€ VIEW MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openView(idx) {
  const e=events[idx]; if(!e) return;
  viewIdx=idx;
  id('vT').textContent    = e.Title||e.title||'';
  id('vDate').textContent = fmtDate(e.date||e.Date||'');
  id('vOwn').textContent  = e.owner||e.Owner||'';
  id('vDesc').textContent = e.Description||e.description||'××™×Ÿ ×ª×™××•×¨';

  const st=e.status||e.Status||'×—×“×©';
  refreshVSt(st);

  const imgSrc=e.Image||e.image||'';
  if(imgSrc.startsWith('data:image')){ id('vImg').src=imgSrc; id('vImg').style.display='block'; id('vImgPH').style.display='none'; }
  else { id('vImg').style.display='none'; id('vImgPH').style.display='flex'; }

  // Tasks
  const tl=id('vtList'); tl.innerHTML='';
  const tasks=(e.tasks||e.Tasks||'').split('|').filter(t=>t.trim());
  if(tasks.length){
    tasks.forEach(t=>{
      const row=document.createElement('div'); row.className='tr';
      const cb=document.createElement('input'); cb.type='checkbox';
      cb.onchange=()=>row.classList.toggle('done',cb.checked);
      const sp=document.createElement('span'); sp.style.fontSize='13px'; sp.textContent=t;
      row.appendChild(cb); row.appendChild(sp); tl.appendChild(row);
    });
  } else {
    tl.innerHTML='<span style="font-size:11px;color:#cbd5e1">××™×Ÿ ××©×™××•×ª</span>';
  }
  showOv('mView');
}

function refreshVSt(st) {
  const map={
    ×—×“×©:   {border:'#93c5fd',bg:'#dbeafe',color:'#1d4ed8'},
    ×‘×˜×™×¤×•×œ:{border:'#fcd34d',bg:'#fef3c7',color:'#b45309'},
    ×‘×•×¦×¢:  {border:'#86efac',bg:'#dcfce7',color:'#16a34a'},
  };
  document.querySelectorAll('.vsb').forEach(b=>{
    const v=b.dataset.v, active=v===st;
    const s=map[v]||{border:'#e2e8f0',bg:'#f8fafc',color:'#94a3b8'};
    b.style.borderColor = active?s.border:'#e2e8f0';
    b.style.background  = active?s.bg:'#f8fafc';
    b.style.color       = active?s.color:'#94a3b8';
  });
  const pill=id('vPill'); pill.textContent=st;
  const ps=map[st]||map['×—×“×©'];
  pill.style.cssText=`position:absolute;bottom:14px;right:14px;padding:4px 12px;border-radius:50px;font-size:11px;font-weight:900;box-shadow:0 2px 8px rgba(0,0,0,.15);background:${ps.bg};color:${ps.color}`;
}

function changeSt(st) {
  if(viewIdx<0) return;
  events[viewIdx].status=st; events[viewIdx].Status=st;
  refreshVSt(st); updateStats(); renderList();
}

// â”€â”€â”€ ADD MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openAdd(){ fillOwnerSelect(); showOv('mAdd'); }
function closeAdd(){ hide('mAdd'); }

// ×”×•×¡×¤×ª ×©×•×¨×ª ××©×™××” â€” ×–×• ×”×¤×•× ×§×¦×™×” ×”××ª×•×§× ×ª
function addRow(containerId) {
  const c = id(containerId);

  const row = document.createElement('div');
  row.className = 'tr';
  row.style.background = 'white';
  row.style.border = '1px solid #e2e8f0';

  const inp = document.createElement('input');
  inp.type = 'text';
  inp.placeholder = '×›×ª×•×‘ ××©×™××”...';
  inp.style.cssText = 'task-inp flex:1;background:transparent;border:none;outline:none;font-size:13px;font-family:Heebo,sans-serif;width:100%';
  inp.className = 'task-inp';

  const del = document.createElement('button');
  del.type = 'button';
  del.style.cssText = 'background:none;border:none;cursor:pointer;padding:4px;color:#fca5a5;flex-shrink:0;display:flex;align-items:center';
  del.innerHTML = '<i data-lucide="trash-2" style="width:15px;height:15px"></i>';
  del.onclick = () => row.remove();

  row.appendChild(inp);
  row.appendChild(del);
  c.appendChild(row);

  lucide.createIcons();
  inp.focus();
}

function setSbActive(b) {
  const map={×—×“×©:'border-color:#93c5fd;background:#dbeafe;color:#1d4ed8',×‘×˜×™×¤×•×œ:'border-color:#fcd34d;background:#fef3c7;color:#b45309',×‘×•×¦×¢:'border-color:#86efac;background:#dcfce7;color:#16a34a'};
  b.style.cssText=(b.style.cssText||'')+';'+(map[b.dataset.v]||'');
}
function setSbInactive(b){
  b.style.borderColor='#e2e8f0'; b.style.background='#f8fafc'; b.style.color='#94a3b8';
}

function handleImg() {
  const f=id('inImg').files[0]; if(!f) return;
  const r=new FileReader();
  r.onload=ev=>{
    if(ev.target.result.length>50000){ alert('×”×ª××•× ×” ×’×“×•×œ×” ××“×™'); id('inImg').value=''; return; }
    img64=ev.target.result;
    id('imgSt').textContent='âœ… ×ª××•× ×” × ×‘×—×¨×”';
    id('imgPE').src=img64; id('imgPW').style.display='block';
  };
  r.readAsDataURL(f);
}

async function save() {
  const title  = id('inT').value.trim();
  const date   = id('inD').value;
  const owner  = id('inO').value;
  const desc   = id('inDesc').value.trim();
  const status = id('inS').value;
  const tasks  = [...id('tList').querySelectorAll('.task-inp')]
                   .map(x=>x.value.trim()).filter(Boolean).join('|');

  if(!title){ alert('× × ×œ×”×–×™×Ÿ ×©× ××™×¨×•×¢'); return; }

  const btn=id('saveBtn'); btn.textContent='×©×•××¨...'; btn.disabled=true;

  const body=new URLSearchParams({title,date,owner,desc,status,tasks,image:img64});
  try { await fetch(POST,{method:'POST',mode:'no-cors',headers:{'Content-Type':'application/x-www-form-urlencoded'},body:body.toString()}); }
  catch(e){ console.error(e); }

  // ×”×•×¡×£ ××™×™×“×™×ª ×œ×¨×©×™××”
  events.unshift({Title:title,date,Date:date,owner,Owner:owner,Description:desc,status,Status:status,tasks,Tasks:tasks,Image:img64});
  renderAll(); closeAdd(); resetForm();
  setTimeout(()=>loadData(),4000);

  btn.textContent='×©××•×¨ ×•×¡× ×›×¨×Ÿ â†'; btn.disabled=false;
}

function resetForm(){
  ['inT','inD','inDesc'].forEach(x=>id(x).value='');
  id('inO').value=''; id('inS').value='×—×“×©';
  id('tList').innerHTML=''; id('inImg').value='';
  id('imgSt').textContent='×”×•×¡×£ ×ª××•× ×” (××•×¤×¦×™×•× ×œ×™)';
  id('imgPW').style.display='none';
  id('sBtns').querySelectorAll('.sb').forEach((b,i)=>{
    if(i===0){ b.style.borderColor='#93c5fd';b.style.background='#dbeafe';b.style.color='#1d4ed8'; }
    else setSbInactive(b);
  });
  img64='';
}

// â”€â”€â”€ VIEW SWITCH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function sv(name){
  ['List','Cal','Tasks'].forEach(v=>{
    id('v'+v).style.display='none';
    const nb=id('nb-'+v.toLowerCase()); if(nb) nb.classList.remove('on');
  });
  id('v'+name).style.display='block';
  const nb=id('nb-'+name.toLowerCase()); if(nb) nb.classList.add('on');
}

// â”€â”€â”€ NOTIFS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function askNotif(){
  Notification.requestPermission().then(p=>alert(p==='granted'?'ğŸ”” ×”×ª×¨××•×ª ×”×•×¤×¢×œ×•!':'×œ× ××•×©×¨'));
}
</script>
</body>
</html>
