<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bat Yam 100</title>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2990/2990995.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary: #0077b6;
            --primary-dark: #023e8a;
            --accent: #f9c74f;
            --bg: #f0f9ff;
        }

        * { box-sizing: border-box; }
        body {
            background: var(--bg);
            font-family: 'Heebo', sans-serif;
            padding-bottom: 100px;
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }

        /* ===== HERO ===== */
        .hero-wrapper {
            position: relative;
            height: 230px;
            border-radius: 0 0 40px 40px;
            overflow: hidden;
            box-shadow: 0 16px 48px -12px rgba(0, 119, 182, 0.55);
            background: linear-gradient(145deg, var(--primary), var(--primary-dark));
        }
        .hero-bg {
            background-image: url('baner.jpg');
            background-size: cover;
            background-position: center top;
            position: absolute; inset: 0; z-index: 0;
            opacity: 0.75;
        }
        .hero-overlay {
            position: absolute; inset: 0; z-index: 1;
            background: linear-gradient(to bottom, rgba(0,30,80,0.3) 0%, rgba(0,20,60,0.6) 100%);
        }
        .hero-content { position: relative; z-index: 2; padding: 22px; height: 100%; display: flex; flex-direction: column; justify-content: space-between; }

        /* Glass buttons */
        .glass-btn {
            background: rgba(255,255,255,0.18);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255,255,255,0.32);
            color: white;
            border-radius: 50px;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            cursor: pointer;
        }
        .glass-btn:active { transform: scale(0.93); background: rgba(255,255,255,0.35); }

        /* ===== CARDS ===== */
        .card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.055);
            border: 1px solid rgba(0,119,182,0.07);
            transition: transform 0.15s, box-shadow 0.15s;
            cursor: pointer;
        }
        .card:active { transform: scale(0.97); box-shadow: 0 1px 6px rgba(0,0,0,0.08); }

        /* ===== NAV ===== */
        .nav-bar {
            position: fixed;
            bottom: 22px; left: 18px; right: 18px;
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(16px);
            padding: 8px 16px;
            border-radius: 26px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 16px 48px -8px rgba(0,0,0,0.14);
            border: 1px solid rgba(255,255,255,0.6);
            z-index: 40;
        }
        .nav-btn {
            padding: 10px 14px;
            border-radius: 18px;
            color: #94a3b8;
            transition: all 0.25s;
            display: flex; flex-direction: column; align-items: center; gap: 3px;
            font-size: 9px; font-weight: 700;
        }
        .nav-btn.active { color: var(--primary); background: #e0f2fe; }
        .nav-add {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 13px;
            border-radius: 22px;
            box-shadow: 0 8px 24px -4px rgba(0,119,182,0.5);
            transform: translateY(-18px);
            border: 4px solid white;
            transition: all 0.2s;
        }
        .nav-add:active { transform: translateY(-18px) scale(0.94); }

        /* ===== STATUS PILL ===== */
        .pill-new    { background:#dbeafe; color:#1d4ed8; }
        .pill-active { background:#fef3c7; color:#b45309; }
        .pill-done   { background:#dcfce7; color:#16a34a; }

        /* ===== CALENDAR ===== */
        .cal-day {
            min-height: 72px;
            background: white;
            border-radius: 10px;
            border: 1px solid #e0f2fe;
            padding: 4px;
            font-size: 10px;
            position: relative;
        }
        .cal-day.today { border: 2px solid var(--primary); background: #f0f9ff; }
        .cal-day.other-month { background: #f8fafc; opacity: 0.5; }
        .cal-event {
            background: var(--primary);
            color: white;
            padding: 2px 4px;
            border-radius: 4px;
            margin-top: 2px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-size: 8px;
            font-weight: 700;
            cursor: pointer;
        }
        .cal-event.mine { background: #16a34a; }

        /* ===== MODALS ===== */
        .modal-sheet {
            position: fixed; inset: 0;
            background: rgba(15,23,42,0.65);
            display: flex; align-items: flex-end;
            justify-content: center;
            z-index: 150;
            backdrop-filter: blur(4px);
        }
        .modal-sheet.sm-center { align-items: center; padding: 16px; }
        .sheet-body {
            background: white;
            width: 100%; max-width: 480px;
            border-radius: 32px 32px 0 0;
            animation: slideUp 0.35s cubic-bezier(0.16,1,0.3,1);
            display: flex; flex-direction: column;
            max-height: 92vh;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }

        /* ===== LOGIN ===== */
        .login-box {
            background: white;
            border-radius: 28px;
            padding: 36px 28px;
            width: 100%; max-width: 340px;
            text-align: center;
            box-shadow: 0 24px 64px -12px rgba(0,0,0,0.25);
            animation: popIn 0.4s cubic-bezier(0.16,1,0.3,1);
        }
        @keyframes popIn { from { transform: scale(0.88); opacity:0; } to { transform: scale(1); opacity:1; } }

        .user-chip {
            padding: 10px 20px;
            border-radius: 50px;
            border: 2px solid #e2e8f0;
            cursor: pointer;
            font-weight: 700;
            font-size: 15px;
            transition: all 0.18s;
            background: white;
        }
        .user-chip:hover, .user-chip.selected {
            border-color: var(--primary);
            background: #e0f2fe;
            color: var(--primary);
        }

        /* ===== TASK ITEM ===== */
        .task-item {
            display: flex; align-items: center; gap-10px;
            padding: 10px 12px;
            background: #f8fafc;
            border-radius: 12px;
            gap: 10px;
            transition: background 0.15s;
        }
        .task-item.done-task { opacity: 0.5; }
        .task-item input[type=checkbox] { width: 18px; height: 18px; accent-color: var(--primary); cursor: pointer; flex-shrink: 0; }
        .task-item span.done-text { text-decoration: line-through; color: #94a3b8; }

        /* ===== STAT CARDS ===== */
        .stat-card { background: white; border-radius: 18px; padding: 14px 16px; border: 1px solid rgba(0,119,182,0.08); box-shadow: 0 2px 8px rgba(0,0,0,0.04); }

        /* ===== SCROLLBAR HIDE ===== */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* ===== BADGE ===== */
        .badge { position: absolute; top: 6px; right: 6px; width: 10px; height: 10px; background: #ef4444; border-radius: 50%; border: 2px solid white; }

        /* ===== LOADER ===== */
        #loader { transition: opacity 0.4s; }
        #loader.fade { opacity: 0; pointer-events: none; }
    </style>
</head>
<body>

<!-- LOADER -->
<div id="loader" class="fixed inset-0 bg-white z-[9999] flex flex-col items-center justify-center">
    <div class="relative mb-5">
        <div class="w-16 h-16 border-4 border-slate-100 border-t-blue-600 rounded-full animate-spin"></div>
        <div class="absolute inset-0 flex items-center justify-center font-black text-blue-600 text-xs">100</div>
    </div>
    <p class="text-slate-400 text-xs font-bold tracking-widest">×˜×•×¢×Ÿ ××¢×¨×›×ª...</p>
</div>

<!-- LOGIN MODAL -->
<div id="loginModal" class="fixed inset-0 bg-slate-900 z-[200] flex items-center justify-center p-5" style="display:none!important">
    <div class="login-box">
        <div class="w-20 h-20 rounded-full bg-blue-50 flex items-center justify-center mx-auto mb-5 text-4xl shadow-inner">ğŸ‘‹</div>
        <h2 class="text-2xl font-black text-slate-800 mb-1">×‘×¨×•×›×™× ×”×‘××™×</h2>
        <p class="text-slate-400 text-sm mb-6">××™ ××ª/×”? ×‘×—×¨/×™ ×©×</p>
        <div class="flex flex-wrap gap-2 justify-center mb-5" id="userChips">
            <!-- chips rendered by JS -->
        </div>
        <input id="customNameInput" type="text" placeholder="×©× ××—×¨..." class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-center font-bold outline-none focus:border-blue-500 mb-4 transition text-sm">
        <button onclick="login()" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black shadow-lg active:scale-95 transition">×›× ×™×¡×” â†’</button>
    </div>
</div>

<!-- SETTINGS MODAL -->
<div id="settingsModal" class="modal-sheet hidden">
    <div class="sheet-body" style="border-radius:32px 32px 0 0; padding:28px;">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-black text-slate-800">×”×’×“×¨×•×ª</h2>
            <button onclick="closeModal('settingsModal')" class="p-2 bg-slate-50 rounded-full"><i data-lucide="x" class="w-5 h-5 text-slate-400"></i></button>
        </div>
        <p class="text-xs font-bold text-slate-400 mb-3 uppercase">×”×—×œ×£ ××©×ª××©</p>
        <div class="flex flex-wrap gap-2 mb-4" id="settingsChips"></div>
        <input id="settingsCustomName" type="text" placeholder="×©× ××—×¨..." class="w-full p-3 bg-slate-50 border border-slate-200 rounded-xl text-center font-bold outline-none focus:border-blue-500 mb-4 transition text-sm">
        <button onclick="switchUser()" class="w-full bg-blue-600 text-white py-3 rounded-xl font-black active:scale-95 transition">×”×—×œ×£</button>
    </div>
</div>

<!-- MAIN APP -->
<div id="app" class="hidden max-w-md mx-auto">

    <!-- HERO -->
    <div class="hero-wrapper">
        <div class="hero-bg"></div>
        <div class="hero-overlay"></div>
        <div class="hero-content">
            <!-- Top row -->
            <div class="flex justify-between items-center">
                <button onclick="openModal('settingsModal'); renderSettingsChips()" class="glass-btn px-3 py-2 text-xs font-bold">
                    <span class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></span>
                    <span id="userGreeting">××•×¨×—</span>
                    <i data-lucide="settings" class="w-3 h-3 opacity-70"></i>
                </button>
                <div class="flex gap-2">
                    <button onclick="requestNotif()" class="glass-btn p-2"><i data-lucide="bell" class="w-5 h-5"></i></button>
                    <button onclick="loadData(true)" class="glass-btn p-2"><i data-lucide="refresh-cw" class="w-5 h-5"></i></button>
                </div>
            </div>
            <!-- Title -->
            <div>
                <h1 class="text-4xl font-black tracking-tighter leading-none text-white drop-shadow-lg mb-1">
                    BAT YAM <span class="text-yellow-300">100</span>
                </h1>
                <p class="text-blue-100 text-sm font-medium opacity-90">× ×™×”×•×œ ×¤×¨×•×™×§×˜×™× Â· 2026</p>
            </div>
        </div>
    </div>

    <!-- CONTENT AREA -->
    <div class="px-4 pt-5">

        <!-- ===== LIST VIEW ===== -->
        <div id="listView">
            <!-- Stats row -->
            <div class="flex gap-3 mb-5 overflow-x-auto scrollbar-hide pb-1">
                <div class="stat-card flex-1 min-w-[120px]">
                    <span class="text-[10px] text-slate-400 font-bold block mb-1">×¡×”"×› ×¤×¨×•×™×§×˜×™×</span>
                    <span id="statTotal" class="text-3xl font-black text-slate-800">0</span>
                </div>
                <div class="stat-card flex-1 min-w-[120px] bg-green-50 border-green-100">
                    <span class="text-[10px] text-green-600 font-bold block mb-1">×”××©×™××•×ª ×©×œ×™</span>
                    <span id="statMine" class="text-3xl font-black text-green-700">0</span>
                </div>
                <div class="stat-card flex-1 min-w-[120px] bg-amber-50 border-amber-100">
                    <span class="text-[10px] text-amber-600 font-bold block mb-1">×‘×˜×™×¤×•×œ</span>
                    <span id="statActive" class="text-3xl font-black text-amber-700">0</span>
                </div>
            </div>
            <h2 class="text-base font-black text-slate-700 mb-3 flex items-center gap-2">
                <i data-lucide="layout-list" class="w-4 h-4 text-blue-500"></i> ×›×œ ×”×¤×¨×•×™×§×˜×™×
            </h2>
            <div id="eventCards" class="space-y-3 pb-28"></div>
        </div>

        <!-- ===== CALENDAR VIEW ===== -->
        <div id="calendarView" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="font-black text-slate-800 text-base" id="calTitle"></h2>
                <div class="flex gap-2">
                    <button type="button" onclick="changeMonth(-1)" class="p-2 bg-white rounded-full shadow-sm border border-slate-100"><i data-lucide="chevron-right" class="w-4 h-4 text-slate-600"></i></button>
                    <button type="button" onclick="changeMonth(1)" class="p-2 bg-white rounded-full shadow-sm border border-slate-100"><i data-lucide="chevron-left" class="w-4 h-4 text-slate-600"></i></button>
                </div>
            </div>
            <div class="grid grid-cols-7 text-center text-[10px] font-black text-slate-400 mb-2 gap-1">
                <div>××³</div><div>×‘×³</div><div>×’×³</div><div>×“×³</div><div>×”×³</div><div>×•×³</div><div>×©×³</div>
            </div>
            <div id="calGrid" class="grid grid-cols-7 gap-1 pb-28"></div>
        </div>

        <!-- ===== TASKS VIEW ===== -->
        <div id="tasksView" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-base font-black text-slate-700 flex items-center gap-2">
                    <i data-lucide="check-square" class="w-4 h-4 text-green-500"></i> ××©×™××•×ª ×¤×ª×•×—×•×ª
                </h2>
                <select id="taskFilter" onchange="renderTasksView()" class="text-xs font-bold bg-white border border-slate-200 rounded-xl px-3 py-2 outline-none">
                    <option value="">×›×•×œ×</option>
                </select>
            </div>
            <div id="taskCards" class="space-y-3 pb-28"></div>
        </div>

    </div>

    <!-- BOTTOM NAV -->
    <div class="nav-bar">
        <button onclick="switchView('list')" id="nav-list" class="nav-btn active">
            <i data-lucide="home" class="w-5 h-5"></i>
            <span>×‘×™×ª</span>
        </button>
        <button onclick="switchView('tasks')" id="nav-tasks" class="nav-btn relative">
            <i data-lucide="check-square" class="w-5 h-5"></i>
            <span>××©×™××•×ª</span>
            <span id="taskBadge" class="badge hidden"></span>
        </button>
        <button onclick="openModal('addModal')" class="nav-add">
            <i data-lucide="plus" class="w-7 h-7"></i>
        </button>
        <button onclick="switchView('calendar')" id="nav-calendar" class="nav-btn">
            <i data-lucide="calendar" class="w-5 h-5"></i>
            <span>×œ×•×— ×©× ×”</span>
        </button>
        <button onclick="openModal('settingsModal'); renderSettingsChips()" id="nav-settings" class="nav-btn">
            <i data-lucide="user" class="w-5 h-5"></i>
            <span>×¤×¨×•×¤×™×œ</span>
        </button>
    </div>
</div>

<!-- ===== ADD EVENT MODAL ===== -->
<div id="addModal" class="modal-sheet hidden">
    <div class="sheet-body" style="height:90vh;">
        <div class="p-5 flex justify-between items-center border-b border-slate-100">
            <h2 class="text-xl font-black text-slate-800">×¤×¨×•×™×§×˜ ×—×“×©</h2>
            <button onclick="closeModal('addModal')" class="p-2 bg-slate-50 rounded-full"><i data-lucide="x" class="w-5 h-5 text-slate-400"></i></button>
        </div>
        <div class="flex-1 overflow-y-auto p-5 space-y-4">
            <div>
                <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">×©× ×”××™×¨×•×¢ *</label>
                <input id="inTitle" type="text" class="w-full p-4 bg-slate-50 rounded-xl border border-slate-200 outline-none font-bold text-lg focus:bg-white focus:border-blue-500 transition">
            </div>
            <div class="grid grid-cols-2 gap-3">
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">×ª××¨×™×š</label>
                    <input id="inDate" type="date" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:border-blue-500">
                </div>
                <div>
                    <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">××—×¨××™</label>
                    <input id="inOwner" type="text" placeholder="×©×" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:border-blue-500 font-medium">
                </div>
            </div>
            <div>
                <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">×¡×˜×˜×•×¡</label>
                <div class="flex gap-2">
                    <button type="button" onclick="setStatus(this,'×—×“×©')" data-status="×—×“×©" class="status-btn flex-1 py-2 rounded-xl font-bold text-sm pill-new border-2 border-blue-200">×—×“×©</button>
                    <button type="button" onclick="setStatus(this,'×‘×˜×™×¤×•×œ')" data-status="×‘×˜×™×¤×•×œ" class="status-btn flex-1 py-2 rounded-xl font-bold text-sm bg-slate-50 text-slate-400 border-2 border-slate-100">×‘×˜×™×¤×•×œ</button>
                    <button type="button" onclick="setStatus(this,'×‘×•×¦×¢')" data-status="×‘×•×¦×¢" class="status-btn flex-1 py-2 rounded-xl font-bold text-sm bg-slate-50 text-slate-400 border-2 border-slate-100">×‘×•×¦×¢</button>
                </div>
                <input type="hidden" id="inStatus" value="×—×“×©">
            </div>
            <div>
                <label class="text-[10px] font-black text-slate-400 uppercase mb-1 block">×ª×™××•×¨</label>
                <textarea id="inDesc" rows="3" class="w-full p-3 bg-slate-50 rounded-xl border border-slate-200 outline-none focus:bg-white focus:border-blue-500 transition text-sm"></textarea>
            </div>
            <div class="bg-slate-50 p-4 rounded-xl border border-slate-100">
                <div class="flex justify-between items-center mb-3">
                    <label class="text-[10px] font-black text-slate-400 uppercase">××©×™××•×ª</label>
                    <button type="button" onclick="addTaskLine('newTasksList')" class="text-blue-600 text-xs font-bold">+ ×”×•×¡×£</button>
                </div>
                <div id="newTasksList" class="space-y-2"></div>
            </div>
            <label class="flex items-center gap-3 p-4 border-2 border-dashed border-slate-200 rounded-xl cursor-pointer hover:border-blue-400 hover:bg-blue-50 transition group">
                <input type="file" id="inImage" class="hidden" accept="image/*" onchange="handleImageUpload(this,'addImgStatus','addImgPreview')">
                <i data-lucide="image-plus" class="text-slate-300 group-hover:text-blue-500 w-5 h-5 transition"></i>
                <div>
                    <span class="text-sm font-bold text-slate-500 group-hover:text-blue-600 block" id="addImgStatus">×”×•×¡×£ ×ª××•× ×” (××•×¤×¦×™×•× ×œ×™)</span>
                    <span class="text-[10px] text-slate-400">×¢×“ ~37KB â€” ××•××œ×¥ ×œ×”×§×˜×™×Ÿ ×œ×¤× ×™</span>
                </div>
            </label>
            <div id="addImgPreview" class="hidden h-36 rounded-xl overflow-hidden border border-slate-100">
                <img id="addImgEl" class="w-full h-full object-cover">
            </div>
        </div>
        <div class="p-5 border-t border-slate-100">
            <button onclick="saveEvent()" id="saveBtn" class="w-full bg-blue-600 text-white py-4 rounded-xl font-black shadow-lg active:scale-95 transition">×©××•×¨ ×•×¡× ×›×¨×Ÿ â†</button>
        </div>
    </div>
</div>

<!-- ===== VIEW EVENT MODAL ===== -->
<div id="viewModal" class="modal-sheet hidden">
    <div class="sheet-body" style="height:88vh; border-radius:32px 32px 0 0;">
        <!-- Image header -->
        <div class="h-44 bg-slate-200 relative shrink-0">
            <img id="viewImg" class="w-full h-full object-cover hidden">
            <div id="viewImgPlaceholder" class="absolute inset-0 flex items-center justify-center bg-gradient-to-br from-blue-50 to-slate-100">
                <i data-lucide="image" class="w-12 h-12 text-slate-200"></i>
            </div>
            <button onclick="closeModal('viewModal')" class="absolute top-4 left-4 bg-black/30 text-white p-2 rounded-full backdrop-blur-sm"><i data-lucide="x" class="w-5 h-5"></i></button>
            <div id="viewStatusPill" class="absolute bottom-4 right-4 px-3 py-1 rounded-full text-xs font-black backdrop-blur-sm shadow-sm"></div>
        </div>
        <!-- Body -->
        <div class="flex-1 overflow-y-auto p-5">
            <h2 id="viewTitle" class="text-2xl font-black text-slate-800 mb-1 leading-snug"></h2>
            <div class="flex items-center gap-2 mb-4 text-sm">
                <span id="viewDate" class="bg-blue-50 text-blue-600 font-bold px-2 py-0.5 rounded-lg text-xs"></span>
                <span class="text-slate-300">â€¢</span>
                <span id="viewOwner" class="text-slate-500 font-medium text-xs"></span>
            </div>

            <!-- Status change -->
            <div class="flex gap-2 mb-5">
                <button onclick="changeViewStatus('×—×“×©')" id="vs-×—×“×©" class="flex-1 py-2 rounded-xl font-bold text-xs border-2 transition">×—×“×©</button>
                <button onclick="changeViewStatus('×‘×˜×™×¤×•×œ')" id="vs-×‘×˜×™×¤×•×œ" class="flex-1 py-2 rounded-xl font-bold text-xs border-2 transition">×‘×˜×™×¤×•×œ</button>
                <button onclick="changeViewStatus('×‘×•×¦×¢')" id="vs-×‘×•×¦×¢" class="flex-1 py-2 rounded-xl font-bold text-xs border-2 transition">×‘×•×¦×¢</button>
            </div>

            <p id="viewDesc" class="text-sm text-slate-600 leading-relaxed bg-slate-50 p-3 rounded-xl mb-5"></p>

            <!-- Tasks checklist -->
            <div class="bg-slate-50 p-4 rounded-xl border border-slate-100 mb-4">
                <div class="flex justify-between items-center mb-3">
                    <h3 class="text-[10px] font-black text-slate-400 uppercase flex items-center gap-1"><i data-lucide="list-checks" class="w-3 h-3"></i> ××©×™××•×ª</h3>
                    <button type="button" onclick="addTaskLine('viewTasksList')" class="text-blue-500 text-xs font-bold">+ ×”×•×¡×£</button>
                </div>
                <div id="viewTasksList" class="space-y-2"></div>
            </div>

            <!-- Upload image button -->
            <label class="flex items-center gap-3 p-3 border-2 border-dashed border-slate-200 rounded-xl cursor-pointer hover:border-blue-400 transition group">
                <input type="file" id="viewImageInput" class="hidden" accept="image/*" onchange="handleImageUpload(this,'viewImgStatus','viewImgPreviewWrap','viewImg','viewImgPlaceholder')">
                <i data-lucide="image-plus" class="w-4 h-4 text-slate-300 group-hover:text-blue-500 transition"></i>
                <span id="viewImgStatus" class="text-xs font-bold text-slate-400 group-hover:text-blue-600 transition">
                    ×”×—×œ×£ / ×”×•×¡×£ ×ª××•× ×”
                </span>
            </label>
            <div id="viewImgPreviewWrap" class="hidden mt-2 h-28 rounded-xl overflow-hidden border border-slate-100">
                <img id="viewImgNew" class="w-full h-full object-cover">
            </div>
        </div>
    </div>
</div>

<script>
// ============================================================
//  CONFIG
// ============================================================
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ02cU8av1KtchNykwq-QxjU6LiLZx-CSp5B28BxAgnsvJjlTwMMW1QO8qNylEYC78qDQFT_S3-fzUA/pub?output=csv";
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxpdgCT9MgQGJbGRJupmNpEZOxSlWBi99GrAznCFVUM7NsMKytt4gjquKR333sTb62vbg/exec";

const PRESET_USERS = ['×‘×Ÿ', '×¨×™× ×ª', '×“×•×“', '×©×¨×”', '××™×›×œ'];

// ============================================================
//  STATE
// ============================================================
let events = [];
let currentUser = localStorage.getItem('batyamUser') || "";
let currentView = 'list';
let calYear = new Date().getFullYear();
let calMonth = new Date().getMonth();
let currentImageBase64 = "";
let viewEventIdx = -1;         // index of currently viewed event
let lastKnownEventCount = parseInt(localStorage.getItem('batyamCount') || '0');

// ============================================================
//  BOOT
// ============================================================
document.addEventListener('DOMContentLoaded', () => {
    lucide.createIcons();
    if (currentUser) {
        bootApp();
    } else {
        showLoginModal();
    }
});

function showLoginModal() {
    const modal = document.getElementById('loginModal');
    modal.style.removeProperty('display');
    modal.classList.remove('hidden');
    renderUserChips('userChips', 'customNameInput');
}

function renderUserChips(containerId, inputId) {
    const c = document.getElementById(containerId);
    c.innerHTML = '';
    PRESET_USERS.forEach(name => {
        const btn = document.createElement('button');
        btn.className = 'user-chip' + (currentUser === name ? ' selected' : '');
        btn.textContent = name;
        btn.onclick = () => {
            document.querySelectorAll(`#${containerId} .user-chip`).forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            if (inputId) document.getElementById(inputId).value = '';
        };
        c.appendChild(btn);
    });
}

function renderSettingsChips() {
    renderUserChips('settingsChips', 'settingsCustomName');
}

function getSelectedChip(containerId, inputId) {
    const selected = document.querySelector(`#${containerId} .user-chip.selected`);
    if (selected) return selected.textContent;
    const custom = document.getElementById(inputId).value.trim();
    return custom || null;
}

function login() {
    const name = getSelectedChip('userChips', 'customNameInput');
    if (!name) return alert("×‘×—×¨ ×©× ××• ×”×§×œ×“ ×©×");
    localStorage.setItem('batyamUser', name);
    currentUser = name;
    document.getElementById('loginModal').classList.add('hidden');
    bootApp();
}

function switchUser() {
    const name = getSelectedChip('settingsChips', 'settingsCustomName');
    if (!name) return alert("×‘×—×¨ ×©×");
    localStorage.setItem('batyamUser', name);
    currentUser = name;
    document.getElementById('userGreeting').innerText = name;
    renderList();
    renderTasksView();
    updateStats();
    closeModal('settingsModal');
}

function bootApp() {
    document.getElementById('userGreeting').innerText = currentUser;
    document.getElementById('app').classList.remove('hidden');
    loadData();
}

// ============================================================
//  DATA
// ============================================================
async function loadData(manual = false) {
    if (manual) {
        document.getElementById('loader').classList.remove('fade');
        document.getElementById('loader').style.opacity = 1;
        document.getElementById('loader').style.pointerEvents = 'auto';
    }
    try {
        const res = await fetch(CSV_URL + '&t=' + Date.now());
        const text = await res.text();
        Papa.parse(text, {
            header: true, skipEmptyLines: true,
            complete: (r) => {
                const newEvents = r.data;
                checkForNewTasks(newEvents);
                events = newEvents;
                lastKnownEventCount = events.length;
                localStorage.setItem('batyamCount', events.length);
                renderAll();
                hideLoader();
            }
        });
    } catch (e) {
        console.error(e);
        hideLoader();
    }
}

function hideLoader() {
    const l = document.getElementById('loader');
    l.classList.add('fade');
    setTimeout(() => { l.style.display = 'none'; }, 500);
}

function renderAll() {
    renderList();
    renderCalendar();
    renderTasksView();
    updateStats();
    populateFilterDropdown();
}

// ============================================================
//  STATS
// ============================================================
function updateStats() {
    document.getElementById('statTotal').innerText = events.length;
    const mine = events.filter(e => (e.Owner || '').includes(currentUser)).length;
    document.getElementById('statMine').innerText = mine;
    const active = events.filter(e => (e.Status || '') === '×‘×˜×™×¤×•×œ').length;
    document.getElementById('statActive').innerText = active;

    // badge
    const myOpen = events.filter(e =>
        (e.Owner || '').includes(currentUser) && (e.Status || '') !== '×‘×•×¦×¢'
    ).length;
    document.getElementById('taskBadge').classList.toggle('hidden', myOpen === 0);
}

// ============================================================
//  LIST VIEW
// ============================================================
function renderList() {
    const container = document.getElementById('eventCards');
    container.innerHTML = '';

    if (!events.length) {
        container.innerHTML = '<p class="text-center text-slate-400 py-16 font-medium">××™×Ÿ ×¤×¨×•×™×§×˜×™× ×¢×“×™×™×Ÿ</p>';
        return;
    }

    const fragment = document.createDocumentFragment();
    [...events].map((e, i) => ({ e, i })).reverse().forEach(({ e, i }) => {
        const title = e.Title || e[1] || '×œ×œ× ×©×';
        const date  = e.Date  || e[2] || '';
        const owner = e.Owner || e[3] || '-';
        const status = e.Status || e[5] || '×—×“×©';
        const isMine = (e.Owner || '').includes(currentUser);
        const day   = date.split('-')[2] || date.split('/')[0] || '?';

        const pillClass = status === '×‘×•×¦×¢' ? 'pill-done' : status === '×‘×˜×™×¤×•×œ' ? 'pill-active' : 'pill-new';

        const card = document.createElement('div');
        card.className = `card p-4 flex items-center gap-4 border-r-4 ${isMine ? 'border-r-green-500' : 'border-r-transparent'}`;
        card.onclick = () => openViewModal(i);
        card.innerHTML = `
            <div class="w-14 h-14 bg-blue-50 rounded-2xl flex flex-col items-center justify-center border border-blue-100 font-black text-blue-600 shrink-0 shadow-sm">
                <span class="text-xl leading-none">${day}</span>
                <span class="text-[8px] opacity-60 mt-0.5">×—×•×“×©</span>
            </div>
            <div class="flex-1 min-w-0">
                <div class="flex justify-between items-start gap-2 mb-1">
                    <h3 class="font-bold text-slate-800 text-sm leading-snug truncate">${title}</h3>
                    <span class="text-[10px] font-black px-2 py-0.5 rounded-full shrink-0 ${pillClass}">${status}</span>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-[11px] text-slate-400 font-medium">ğŸ‘¤ ${owner}</span>
                    ${isMine ? '<span class="text-[10px] bg-green-50 text-green-600 px-1.5 py-0.5 rounded font-bold">×©×œ×™ âœ“</span>' : ''}
                </div>
            </div>
            <i data-lucide="chevron-left" class="w-4 h-4 text-slate-300 shrink-0"></i>`;
        fragment.appendChild(card);
    });

    container.appendChild(fragment);
    lucide.createIcons();
}

// ============================================================
//  CALENDAR VIEW
// ============================================================
function renderCalendar() {
    const grid = document.getElementById('calGrid');
    grid.innerHTML = '';

    const year = calYear, month = calMonth;
    document.getElementById('calTitle').innerText =
        new Date(year, month, 1).toLocaleDateString('he-IL', { month: 'long', year: 'numeric' });

    // âœ… ×ª×™×§×•×Ÿ: firstDay â€” 0=×¨××©×•×Ÿ (××³), 6=×©×‘×ª (×©×³) â€” ××¡×¤×¨ ×ª××™× ×¨×™×§×™× ××©×××œ ×‘×’×¨×™×“ RTL
    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const today = new Date();

    // ×ª××™× ×¨×™×§×™× ×œ×¤× ×™ ×ª×—×™×œ×ª ×”×—×•×“×© (RTL â€” ×¨××©×•×Ÿ ×”×•× ×”×¨××©×•×Ÿ)
    for (let i = 0; i < firstDay; i++) {
        const blank = document.createElement('div');
        blank.className = 'cal-day other-month';
        grid.appendChild(blank);
    }

    for (let d = 1; d <= daysInMonth; d++) {
        // âœ… ×ª×™×§×•×Ÿ: ×‘× ×™×™×ª ××—×¨×•×–×ª ×ª××¨×™×š ×œ×›×œ ×¤×•×¨××˜ ××¤×©×¨×™ ×-CSV
        const mm = String(month + 1).padStart(2, '0');
        const dd = String(d).padStart(2, '0');
        const dateISO  = `${year}-${mm}-${dd}`;       // YYYY-MM-DD
        const dateSlash = `${d}/${month+1}/${year}`;  // D/M/YYYY
        const dateSlash2 = `${dd}/${mm}/${year}`;     // DD/MM/YYYY

        const dayEvents = events.filter(e => {
            const evDate = (e.Date || '').trim();
            return evDate === dateISO || evDate === dateSlash || evDate === dateSlash2 ||
                   evDate.startsWith(dateISO);
        });

        const isToday = today.getDate()===d && today.getMonth()===month && today.getFullYear()===year;

        const cell = document.createElement('div');
        cell.className = `cal-day${isToday ? ' today' : ''}`;

        // âœ… ××¡×¤×¨ ×”×™×•× ×¢× ×”×“×’×©×” ×‘×¨×•×¨×”
        const dayNum = document.createElement('span');
        dayNum.className = `font-bold block mb-0.5 ${isToday ? 'text-blue-600' : 'text-slate-500'}`;
        dayNum.style.fontSize = '10px';
        dayNum.textContent = d;
        cell.appendChild(dayNum);

        dayEvents.forEach(e => {
            const idx = events.indexOf(e);
            const isMine = (e.Owner || '').includes(currentUser);
            const ev = document.createElement('div');
            ev.className = `cal-event${isMine ? ' mine' : ''}`;
            ev.textContent = e.Title || e[1] || 'â€”';
            ev.onclick = (evt) => { evt.stopPropagation(); openViewModal(idx); };
            cell.appendChild(ev);
        });
        grid.appendChild(cell);
    }
}

function changeMonth(delta) {
    calMonth += delta;
    if (calMonth > 11) { calMonth = 0; calYear++; }
    if (calMonth < 0)  { calMonth = 11; calYear--; }
    renderCalendar();
}

// ============================================================
//  TASKS VIEW
// ============================================================
function populateFilterDropdown() {
    const sel = document.getElementById('taskFilter');
    const current = sel.value;
    const owners = [...new Set(events.map(e => e.Owner || e[3] || '').filter(Boolean))];
    sel.innerHTML = '<option value="">×›×•×œ×</option>';
    owners.forEach(o => {
        const opt = document.createElement('option');
        opt.value = o; opt.textContent = o;
        if (o === current) opt.selected = true;
        sel.appendChild(opt);
    });
}

function renderTasksView() {
    const container = document.getElementById('taskCards');
    container.innerHTML = '';
    const filter = document.getElementById('taskFilter').value;

    const openEvents = events.filter(e => {
        const owner = e.Owner || e[3] || '';
        const status = e.Status || e[5] || '×—×“×©';
        if (status === '×‘×•×¦×¢') return false;
        if (filter && !owner.includes(filter)) return false;
        return true;
    });

    if (!openEvents.length) {
        container.innerHTML = '<div class="text-center py-16"><p class="text-4xl mb-2">ğŸ‰</p><p class="text-slate-400 font-medium">××™×Ÿ ××©×™××•×ª ×¤×ª×•×—×•×ª!</p></div>';
        return;
    }

    const fragment = document.createDocumentFragment();
    openEvents.forEach(e => {
        const tasks = (e.Tasks || e[6] || '').split('|').filter(t => t.trim());
        const isMine = (e.Owner||'').includes(currentUser);
        const idx = events.indexOf(e);

        const card = document.createElement('div');
        card.className = `card p-4 border-r-4 ${isMine ? 'border-r-green-500' : 'border-r-blue-200'}`;
        card.innerHTML = `
            <div class="flex justify-between items-center mb-3 pb-2 border-b border-slate-50">
                <h3 class="font-bold text-slate-800 text-sm truncate">${e.Title||e[1]}</h3>
                <span class="text-[10px] font-bold text-slate-400 shrink-0 mr-2">ğŸ‘¤ ${e.Owner||e[3]||'-'}</span>
            </div>
            <div class="space-y-1.5">
                ${tasks.length ? tasks.map(t => `
                    <div class="task-item">
                        <input type="checkbox" onclick="this.parentElement.classList.toggle('done-task')">
                        <span>${t}</span>
                    </div>`).join('') : '<span class="text-xs text-slate-300">××™×Ÿ ××©×™××•×ª ××¤×•×¨×˜×•×ª</span>'}
            </div>
            <button onclick="openViewModal(${idx})" class="mt-3 text-xs font-bold text-blue-500">×¤×ª×— ×¤×¨×•×™×§×˜ â†</button>`;
        fragment.appendChild(card);
    });
    container.appendChild(fragment);
}

// ============================================================
//  VIEW MODAL
// ============================================================
function openViewModal(idx) {
    const e = events[idx];
    if (!e) return;
    viewEventIdx = idx;

    document.getElementById('viewTitle').innerText = e.Title || e[1];
    document.getElementById('viewDate').innerText  = e.Date  || e[2];
    document.getElementById('viewOwner').innerText = e.Owner || e[3];
    document.getElementById('viewDesc').innerText  = e.Description || e[4] || '××™×Ÿ ×ª×™××•×¨';

    const status = e.Status || e[5] || '×—×“×©';
    updateViewStatusButtons(status);

    // image
    const imgSrc = e.Image || e[7];
    if (imgSrc && imgSrc.startsWith('data:image')) {
        document.getElementById('viewImg').src = imgSrc;
        document.getElementById('viewImg').classList.remove('hidden');
        document.getElementById('viewImgPlaceholder').classList.add('hidden');
    } else {
        document.getElementById('viewImg').classList.add('hidden');
        document.getElementById('viewImgPlaceholder').classList.remove('hidden');
    }

    // tasks checklist
    const tasksStr = e.Tasks || e[6] || '';
    const tList = document.getElementById('viewTasksList');
    tList.innerHTML = '';
    if (tasksStr) {
        tasksStr.split('|').filter(t=>t.trim()).forEach(t => {
            const div = document.createElement('div');
            div.className = 'task-item';
            div.innerHTML = `<input type="checkbox" onclick="this.parentElement.classList.toggle('done-task')"><span>${t}</span>`;
            tList.appendChild(div);
        });
    } else {
        tList.innerHTML = '<span class="text-xs text-slate-300">××™×Ÿ ××©×™××•×ª</span>';
    }

    // reset new image upload
    document.getElementById('viewImageInput').value = '';
    document.getElementById('viewImgStatus').innerText = '×”×—×œ×£ / ×”×•×¡×£ ×ª××•× ×”';
    document.getElementById('viewImgPreviewWrap').classList.add('hidden');

    openModal('viewModal');
}

function updateViewStatusButtons(status) {
    const statuses = ['×—×“×©','×‘×˜×™×¤×•×œ','×‘×•×¦×¢'];
    const pillMap = { '×—×“×©': 'bg-blue-100 text-blue-800', '×‘×˜×™×¤×•×œ': 'bg-amber-100 text-amber-800', '×‘×•×¦×¢': 'bg-green-100 text-green-800' };
    const activeMap = { '×—×“×©': 'pill-new border-blue-400', '×‘×˜×™×¤×•×œ': 'pill-active border-amber-400', '×‘×•×¦×¢': 'pill-done border-green-400' };

    statuses.forEach(s => {
        const btn = document.getElementById('vs-' + s);
        if (s === status) {
            btn.className = `flex-1 py-2 rounded-xl font-bold text-xs border-2 ${activeMap[s]}`;
        } else {
            btn.className = 'flex-1 py-2 rounded-xl font-bold text-xs border-2 bg-slate-50 text-slate-400 border-slate-100';
        }
    });

    const pill = document.getElementById('viewStatusPill');
    pill.innerText = status;
    pill.className = `absolute bottom-4 right-4 px-3 py-1 rounded-full text-xs font-black backdrop-blur-sm shadow-sm ${pillMap[status]}`;
}

function changeViewStatus(status) {
    if (viewEventIdx < 0) return;
    events[viewEventIdx].Status = status;
    updateViewStatusButtons(status);
    updateStats();
    renderList();
    // fire-and-forget update to sheet
    sendUpdate(viewEventIdx, { status });
}

// ============================================================
//  ADD EVENT
// ============================================================
function setStatus(btn, val) {
    document.getElementById('inStatus').value = val;
    document.querySelectorAll('.status-btn').forEach(b => {
        b.className = 'status-btn flex-1 py-2 rounded-xl font-bold text-sm bg-slate-50 text-slate-400 border-2 border-slate-100';
    });
    const cls = val==='×‘×•×¦×¢' ? 'pill-done border-green-300' : val==='×‘×˜×™×¤×•×œ' ? 'pill-active border-amber-300' : 'pill-new border-blue-300';
    btn.className = `status-btn flex-1 py-2 rounded-xl font-bold text-sm ${cls} border-2`;
}

function addTaskLine(containerId) {
    // âœ… ×ª×™×§×•×Ÿ: div ×‘×•×“×“ â€” ×›×¤×ª×•×¨ ×”××—×™×§×” ××•×—×§ ××ª ×”-div ×¢×¦××•
    const row = document.createElement('div');
    row.className = 'flex gap-2';
    row.innerHTML = `
        <input type="text" class="task-input flex-1 bg-white border border-slate-200 rounded-xl p-2.5 text-sm outline-none focus:border-blue-400" placeholder="××©×™××”...">
        <button type="button" onclick="this.parentElement.remove()" class="text-red-400 shrink-0 p-1 hover:text-red-600"><i data-lucide="trash-2" class="w-4 h-4"></i></button>`;
    document.getElementById(containerId).appendChild(row);
    lucide.createIcons();
}

function handleImageUpload(input, statusId, previewWrapperId, imgElId, placeholderId) {
    if (!input.files || !input.files[0]) return;
    const reader = new FileReader();
    reader.onload = function(ev) {
        if (ev.target.result.length > 50000) {
            alert(`×”×ª××•× ×” ×’×“×•×œ×” ××“×™ (${Math.round(ev.target.result.length/1024)}KB).\n×‘×—×¨ ×ª××•× ×” ×§×˜× ×” ×-37KB.`);
            input.value = '';
            return;
        }
        currentImageBase64 = ev.target.result;
        document.getElementById(statusId).innerText = 'âœ… ×ª××•× ×” × ×‘×—×¨×”';
        const wrap = document.getElementById(previewWrapperId);
        if (wrap) {
            wrap.classList.remove('hidden');
            const imgEl = imgElId ? document.getElementById(imgElId) : wrap.querySelector('img');
            if (imgEl) imgEl.src = ev.target.result;
        }
        if (placeholderId) document.getElementById(placeholderId).classList.add('hidden');
    };
    reader.readAsDataURL(input.files[0]);
}

async function saveEvent() {
    const title  = document.getElementById('inTitle').value.trim();
    const date   = document.getElementById('inDate').value;
    const owner  = document.getElementById('inOwner').value.trim();
    const desc   = document.getElementById('inDesc').value.trim();
    const status = document.getElementById('inStatus').value;
    const tasks  = Array.from(document.querySelectorAll('#newTasksList .task-input'))
                        .map(i => i.value.trim()).filter(Boolean).join('|');

    console.log('ğŸ“¤ ×©×•×œ×— ×œ××§×¡×œ:', { title, date, owner, status, tasks }); // debug

    if (!title) return alert('× × ×œ×”×–×™×Ÿ ×©× ××™×¨×•×¢');

    const btn = document.getElementById('saveBtn');
    btn.innerText = '×©×•××¨...';
    btn.disabled = true;

    const formData = new URLSearchParams();
    formData.append('title', title);
    formData.append('date', date);
    formData.append('owner', owner);
    formData.append('desc', desc);
    formData.append('status', status);
    formData.append('tasks', tasks);
    formData.append('image', currentImageBase64);

    let ok = false;
    try {
        await fetch(APPS_SCRIPT_URL, {
            method: 'POST', mode: 'no-cors',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: formData.toString()
        });
        ok = true;
    } catch(err) { console.error(err); }

    // optimistic insert
    const newEvent = { Title:title, Date:date, Owner:owner, Description:desc, Status:status, Tasks:tasks, Image:currentImageBase64 };
    events.unshift(newEvent);
    renderAll();

    closeModal('addModal');
    resetAddForm();

    if (ok) {
        notifyUser('×”××™×¨×•×¢ × ×©××¨ ×‘×”×¦×œ×—×”! âœ…', title);
        setTimeout(() => loadData(), 3000);
    } else {
        alert('âš ï¸ ×©×’×™××ª ×¨×©×ª â€” ×”××™×¨×•×¢ × ×•×¡×£ ××§×•××™×ª ×‘×œ×‘×“');
    }

    btn.innerText = '×©××•×¨ ×•×¡× ×›×¨×Ÿ â†';
    btn.disabled = false;
}

function resetAddForm() {
    ['inTitle','inDate','inOwner','inDesc'].forEach(id => document.getElementById(id).value = '');
    document.getElementById('inStatus').value = '×—×“×©';
    document.getElementById('newTasksList').innerHTML = '';
    document.getElementById('inImage').value = '';
    document.getElementById('addImgStatus').innerText = '×”×•×¡×£ ×ª××•× ×” (××•×¤×¦×™×•× ×œ×™)';
    document.getElementById('addImgPreview').classList.add('hidden');
    // reset status buttons
    document.querySelectorAll('.status-btn').forEach((b,i) => {
        if(i===0) b.className='status-btn flex-1 py-2 rounded-xl font-bold text-sm pill-new border-2 border-blue-200';
        else b.className='status-btn flex-1 py-2 rounded-xl font-bold text-sm bg-slate-50 text-slate-400 border-2 border-slate-100';
    });
    currentImageBase64 = '';
}

// ============================================================
//  SEND UPDATE (status change)
// ============================================================
async function sendUpdate(idx, fields) {
    const e = events[idx];
    const formData = new URLSearchParams();
    formData.append('action', 'update');
    formData.append('title', e.Title || '');
    formData.append('status', fields.status || e.Status || '');
    try {
        await fetch(APPS_SCRIPT_URL, {
            method:'POST', mode:'no-cors',
            headers:{'Content-Type':'application/x-www-form-urlencoded'},
            body: formData.toString()
        });
    } catch(err) { console.error('Update error:', err); }
}

// ============================================================
//  NOTIFICATIONS
// ============================================================
function checkForNewTasks(newEvents) {
    if (!currentUser) return;
    const myOld = lastKnownEventCount;
    const myNew = newEvents.filter(e => (e.Owner||'').includes(currentUser)).length;
    if (myNew > myOld && lastKnownEventCount > 0) {
        notifyUser('××©×™××” ×—×“×©×” ×¢×‘×•×¨×š! ğŸ””', '× ×•×¡×¤×” ××©×™××” ×—×“×©×” ×‘-Bat Yam 100');
    }
}

function notifyUser(title, body) {
    if (Notification.permission === 'granted') {
        new Notification(title, { body, icon: 'https://cdn-icons-png.flaticon.com/512/2990/2990995.png' });
    }
}

function requestNotif() {
    Notification.requestPermission().then(p => {
        alert(p === 'granted' ? 'ğŸ”” ×”×ª×¨××•×ª ×”×•×¤×¢×œ×•!' : '×”×ª×¨××•×ª ×œ× ××•×©×¨×•');
    });
}

// ============================================================
//  VIEW SWITCHING
// ============================================================
function switchView(name) {
    ['list','calendar','tasks'].forEach(v => {
        document.getElementById(v+'View').classList.add('hidden');
        const btn = document.getElementById('nav-'+v);
        if (btn) btn.classList.remove('active');
    });
    document.getElementById(name+'View').classList.remove('hidden');
    const activeBtn = document.getElementById('nav-'+name);
    if (activeBtn) activeBtn.classList.add('active');
    currentView = name;
    if (name === 'calendar') renderCalendar();
    if (name === 'tasks') renderTasksView();
}

// ============================================================
//  MODAL HELPERS
// ============================================================
function openModal(id) {
    document.getElementById(id).classList.remove('hidden');
    lucide.createIcons();
}
function closeModal(id) {
    document.getElementById(id).classList.add('hidden');
}

// close on backdrop click
document.addEventListener('click', (ev) => {
    ['addModal','viewModal','settingsModal'].forEach(id => {
        const modal = document.getElementById(id);
        if (ev.target === modal) closeModal(id);
    });
});
</script>
</body>
</html>
