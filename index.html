<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bat Yam 100</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0077b6; --bg: #f8fafc; }
        body { background: var(--bg); font-family: 'Heebo', sans-serif; padding-bottom: 80px; }
        .hero { background-image: linear-gradient(to bottom, rgba(0,50,100,0.6), rgba(0,119,182,0.2)), url('baner.jpg'); background-size: cover; background-position: center; height: 180px; border-radius: 0 0 30px 30px; }
        .muni-card { background: white; border-radius: 20px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid #f1f5f9; transition: 0.2s; }
        .nav-btn.active { background: var(--primary); color: white; box-shadow: 0 10px 15px -3px rgba(0, 119, 182, 0.3); }
    </style>
</head>
<body>

<div id="loader" class="fixed inset-0 bg-white z-[9999] flex flex-col items-center justify-center transition-opacity duration-300">
    <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
    <p class="text-gray-400 font-bold">注 转...</p>
</div>

<div class="max-w-xl mx-auto min-h-screen">
    <div class="hero p-6 flex flex-col justify-between text-white shadow-xl">
        <div class="flex justify-between items-center">
            <div class="bg-black/20 backdrop-blur-md px-4 py-1.5 rounded-full text-xs font-bold border border-white/10" id="userDisplay">专</div>
            <div class="flex gap-2">
                <button onclick="loadData()" class="bg-white/20 p-2 rounded-full backdrop-blur-md"><i data-lucide="refresh-cw" class="w-5 h-5"></i></button>
                <button onclick="openModal('addModal')" class="bg-white/40 p-2 rounded-full backdrop-blur-md"><i data-lucide="plus" class="w-5 h-5"></i></button>
            </div>
        </div>
        <div>
            <h1 class="text-3xl font-black tracking-tighter leading-none">BAT YAM <span class="text-yellow-400">100</span></h1>
            <p class="text-blue-100 text-sm font-medium mt-1">砖专  专注</p>
        </div>
    </div>

    <div class="grid grid-cols-2 gap-4 px-6 -mt-8 relative z-10">
        <div class="muni-card p-4 text-center">
            <span class="text-[10px] text-gray-400 font-black uppercase block">住" 驻专拽</span>
            <span id="stat-total" class="text-2xl font-black text-blue-600">0</span>
        </div>
        <div class="muni-card p-4 text-center">
            <span class="text-[10px] text-gray-400 font-black uppercase block">砖转 驻转转</span>
            <span id="stat-tasks" class="text-2xl font-black text-red-500">0</span>
        </div>
    </div>

    <div id="listView" class="p-6 space-y-4 pb-24"></div>

    <div class="fixed bottom-6 left-6 right-6 bg-white/80 backdrop-blur-xl border border-white shadow-2xl rounded-3xl p-2 flex justify-around items-center max-w-xl mx-auto z-50">
        <button onclick="switchTab('list')" class="nav-btn active flex-1 py-3 rounded-2xl flex flex-col items-center gap-1 transition-all"><i data-lucide="layout-list" class="w-5 h-5"></i><span class="text-[10px] font-bold">专砖</span></button>
        <button onclick="switchTab('calendar')" class="nav-btn flex-1 py-3 rounded-2xl flex flex-col items-center gap-1 transition-all text-gray-400"><i data-lucide="calendar" class="w-5 h-5"></i><span class="text-[10px] font-bold"></span></button>
        <button onclick="switchTab('tasks')" class="nav-btn flex-1 py-3 rounded-2xl flex flex-col items-center gap-1 transition-all text-gray-400"><i data-lucide="check-square" class="w-5 h-5"></i><span class="text-[10px] font-bold">砖转</span></button>
    </div>
</div>

<div id="addModal" class="fixed inset-0 bg-slate-900/60 hidden z-[100] flex items-end sm:items-center justify-center backdrop-blur-sm">
    <div class="bg-white w-full max-w-md rounded-t-3xl sm:rounded-3xl p-8 shadow-2xl">
        <h2 class="text-2xl font-black text-slate-800 mb-6">住驻转 专注</h2>
        <div class="space-y-4">
            <input id="inTitle" type="text" placeholder="砖 专注" class="w-full p-4 bg-slate-50 rounded-2xl border border-slate-100 outline-none focus:border-blue-500 font-bold">
            <input id="inDate" type="text" placeholder="转专 (DD/MM/YYYY)" class="w-full p-4 bg-slate-50 rounded-2xl border border-slate-100 outline-none">
            <input id="inOwner" type="text" placeholder="专" class="w-full p-4 bg-slate-50 rounded-2xl border border-slate-100 outline-none">
            <button onclick="saveNewEvent()" id="saveBtn" class="w-full bg-blue-600 text-white py-4 rounded-2xl font-black shadow-lg shadow-blue-200 active:scale-95 transition">砖专 拽住</button>
            <button onclick="closeModal('addModal')" class="w-full text-gray-400 font-bold py-2">住专</button>
        </div>
    </div>
</div>

<script>
    // 拽砖专 砖
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ02cU8av1KtchNykwq-QxjU6LiLZx-CSp5B28BxAgnsvJjlTwMMW1QO8qNylEYC78qDQFT_S3-fzUA/pub?output=csv";
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwuFrMR6GRahlYczIT8NDsv2GAbARxFGdud-8N4rQUFDTI8U4MG-5iAc0ljOlw1NmTVRw/exec";

    let events = [];

    async function loadData() {
        document.getElementById('loader').style.display = 'flex';
        try {
            const response = await fetch(CSV_URL + '&t=' + Date.now());
            const csvText = await response.text();
            
            Papa.parse(csvText, {
                header: true,
                skipEmptyLines: true,
                complete: (results) => {
                    events = results.data;
                    renderList();
                    document.getElementById('stat-total').innerText = events.length;
                    document.getElementById('loader').style.display = 'none';
                }
            });
        } catch (e) {
            alert("砖 注");
            document.getElementById('loader').style.display = 'none';
        }
    }

    function renderList() {
        const list = document.getElementById('listView');
        list.innerHTML = '';
        events.forEach(e => {
            const title = e.Title || e['砖 专注'] || ' 砖';
            const date = e.Date || e['转专'] || '';
            const owner = e.Owner || e['专'] || '-';
            
            list.innerHTML += `
                <div class="muni-card p-5 flex items-center gap-5">
                    <div class="w-12 h-12 bg-blue-50 rounded-2xl flex flex-col items-center justify-center border border-blue-100 text-blue-600 font-black">
                        <span class="text-lg">${date.split('/')[0] || '?'}</span>
                    </div>
                    <div class="flex-1">
                        <h3 class="font-bold text-slate-800">${title}</h3>
                        <p class="text-xs text-gray-400 font-medium"> ${owner}</p>
                    </div>
                    <div class="w-2 h-2 rounded-full bg-blue-400"></div>
                </div>
            `;
        });
        lucide.createIcons();
    }

    async function saveNewEvent() {
        const title = document.getElementById('inTitle').value;
        if(!title) return alert(" 砖");
        
        const btn = document.getElementById('saveBtn');
        btn.innerText = "砖专...";
        btn.disabled = true;

        const payload = {
            id: 'evt_' + Date.now(),
            title: title,
            dateStr: document.getElementById('inDate').value,
            owner: document.getElementById('inOwner').value,
            status: '砖',
            desc: ''
        };

        try {
            await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            alert("砖专! 住专 转爪注 转 拽.");
            closeModal('addModal');
            document.getElementById('inTitle').value = '';
            setTimeout(loadData, 2000);
        } catch (e) {
            alert("砖 砖专");
        } finally {
            btn.innerText = "砖专 拽住";
            btn.disabled = false;
        }
    }

    function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
    function switchTab(tab) { alert("转爪转 " + tab + " 转转注 专 注"); }

    document.addEventListener('DOMContentLoaded', loadData);
</script>

</body>
</html>
