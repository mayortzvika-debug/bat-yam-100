<!DOCTYPE html>

<html lang="he" dir="rtl">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Bat Yam 100</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <script src="https://unpkg.com/lucide@latest"></script>

    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@400;700;900&display=swap" rel="stylesheet">

    <style>

        body { background: #f1f5f9; font-family: 'Heebo', sans-serif; }

        .hero { background: #0077b6; border-radius: 0 0 20px 20px; }

        .card { background: white; border-radius: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }

    </style>

</head>

<body class="pb-10">



<div id="loader" class="fixed inset-0 bg-white z-50 flex items-center justify-center font-bold text-blue-600">注 转...</div>



<div class="max-w-md mx-auto">

    <div class="hero p-6 text-white shadow-lg">

        <div class="flex justify-between items-center mb-4">

            <span class="text-xs font-bold opacity-80"> 注专转 转-</span>

            <button onclick="loadData()" class="p-2 bg-white/20 rounded-full hover:bg-white/30 transition"><i data-lucide="refresh-cw" class="w-4 h-4"></i></button>

        </div>

        <h1 class="text-3xl font-black">BAT YAM <span class="text-yellow-400">100</span></h1>

    </div>



    <div class="p-4 flex justify-between items-center">

        <h2 class="font-bold text-slate-700">专注 拽专</h2>

        <button onclick="document.getElementById('addModal').classList.remove('hidden')" class="bg-blue-600 text-white px-4 py-2 rounded-xl text-sm font-bold flex items-center gap-2 shadow-md">

            <i data-lucide="plus" class="w-4 h-4"></i> 住祝 砖

        </button>

    </div>



    <div id="listView" class="px-4 space-y-3"></div>

</div>



<div id="addModal" class="fixed inset-0 bg-black/60 hidden z-50 flex items-center justify-center p-4 backdrop-blur-sm">

    <div class="bg-white w-full rounded-2xl p-6 shadow-2xl">

        <h2 class="text-xl font-bold mb-4 text-slate-800">专注 砖 拽住</h2>

        <div class="space-y-4">

            <input id="inTitle" type="text" placeholder="砖 专注" class="w-full p-4 bg-slate-50 border rounded-xl outline-none focus:border-blue-500">

            <input id="inDate" type="text" placeholder="转专" class="w-full p-4 bg-slate-50 border rounded-xl outline-none">

            <input id="inOwner" type="text" placeholder="专" class="w-full p-4 bg-slate-50 border rounded-xl outline-none">

            <button onclick="saveEvent()" id="btnSave" class="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg shadow-lg active:scale-95 transition">砖专 拽住</button>

            <button onclick="document.getElementById('addModal').classList.add('hidden')" class="w-full text-slate-400 font-medium py-2">住专</button>

        </div>

    </div>

</div>



<script>

    // 专转

    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQ02cU8av1KtchNykwq-QxjU6LiLZx-CSp5B28BxAgnsvJjlTwMMW1QO8qNylEYC78qDQFT_S3-fzUA/pub?output=csv";

    

    // *** 砖  拽砖专 -Deploy 砖 砖 ***

    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxi2_n7OgVJiUoNVlQojlZSJQ9yqnyLE9b_rn7n9ggUs9nKlbveNEPHUREWLzFvsRt8xw/exec";



    let events = [];



    async function loadData() {

        document.getElementById('loader').classList.remove('hidden');

        try {

            const res = await fetch(CSV_URL + "&t=" + Date.now());

            const text = await res.text();

            Papa.parse(text, {header:true, skipEmptyLines:true, complete: r => {

                events = r.data;

                render();

                document.getElementById('loader').classList.add('hidden');

            }});

        } catch(e) { 

            console.error(e);

            document.getElementById('loader').classList.add('hidden');

        }

    }



    async function saveEvent() {

        const title = document.getElementById('inTitle').value;

        const date = document.getElementById('inDate').value;

        const owner = document.getElementById('inOwner').value;



        if(!title) return alert("  砖");



        const btn = document.getElementById('btnSave');

        btn.innerText = "砖专...";

        btn.disabled = true;



        const payload = { title: title, dateStr: date, owner: owner };



        try {

            // 砖 拽住 (no-cors 专 注转 住转 )

            await fetch(APPS_SCRIPT_URL, {

                method: 'POST',

                mode: 'no-cors',

                cache: 'no-cache',

                headers: { 'Content-Type': 'application/json' },

                body: JSON.stringify(payload)

            });



            // 注 转  爪 砖转砖

            events.unshift({ "Title": title, "Date": date, "Owner": owner });

            render();

            

            document.getElementById('addModal').classList.add('hidden');

            document.getElementById('inTitle').value = '';

            

            alert("专注 砖专 爪!");

        } catch(e) {

            alert("转拽 砖专: " + e);

        } finally {

            btn.innerText = "砖专 拽住";

            btn.disabled = false;

        }

    }



    function render() {

        const list = document.getElementById('listView');

        list.innerHTML = events.length ? '' : '<p class="text-center text-slate-400 pt-10"> 专注</p>';

        

        events.forEach(e => {

            const t = e.Title || e['砖 专注'] || e['转专转'] || ' 砖';

            const d = e.Date || e['转专'] || '';

            

            list.innerHTML += `

                <div class="card p-4 border-r-4 border-blue-500">

                    <div class="font-bold text-slate-800">${t}</div>

                    <div class="flex justify-between items-center mt-2 text-xs text-slate-500 font-medium">

                        <span> ${d}</span>

                        <span> ${e.Owner || e['专'] || '-'}</span>

                    </div>

                </div>

            `;

        });

        lucide.createIcons();

    }



    document.addEventListener('DOMContentLoaded', loadData);

</script>

</body>

</html>

